<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Budget">
<meta name="theme-color" content="#09090b">
<title>Budget</title>
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;background:#09090b;color:#fafafa;overflow-x:hidden}
body{font-family:-apple-system,BlinkMacSystemFont,system-ui,sans-serif;-webkit-overflow-scrolling:touch;overscroll-behavior-y:contain}
::-webkit-scrollbar{display:none}
input,select,button{font-family:inherit;font-size:16px}
input[type=date]::-webkit-calendar-picker-indicator{filter:invert(.7)}
button{-webkit-user-select:none;user-select:none;touch-action:manipulation}
button:active{opacity:.7!important;transform:scale(.97)}
@supports(padding:env(safe-area-inset-top)){body{padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)}}
</style>
</head>
<body>
<div id="status" style="background:#09090b;color:#71717a;font-family:system-ui;padding:40px;min-height:100vh;font-size:13px;line-height:2">
Starting v6...<br>
</div>
<div id="root" style="display:none"></div>
<script>
// STEP 1: Kill ALL service workers and caches
var statusEl=document.getElementById("status");
function log(msg){statusEl.innerHTML+=msg+"<br>"}
try{
  if("serviceWorker"in navigator){
    navigator.serviceWorker.getRegistrations().then(function(regs){
      log("Found "+regs.length+" service worker(s)");
      for(var i=0;i<regs.length;i++){regs[i].unregister();log("Unregistered SW #"+(i+1))}
    }).catch(function(e){log("SW error: "+e.message)})
  }else{log("No SW support")}
  if(window.caches){
    caches.keys().then(function(keys){
      log("Found "+keys.length+" cache(s)");
      for(var i=0;i<keys.length;i++){caches.delete(keys[i]);log("Deleted cache: "+keys[i])}
    }).catch(function(e){log("Cache error: "+e.message)})
  }else{log("No caches")}
}catch(e){log("Cleanup error: "+e.message)}
</script>
<script>
// STEP 2: Load React
window.onerror=function(msg,src,line){
  document.getElementById("status").style.display="block";
  document.getElementById("root").style.display="none";
  log("<span style='color:#f87171'>ERROR: "+msg+" (line "+line+")</span>");
  return true
};
log("Loading React...");
</script>
<script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js" onload="log('React loaded')" onerror="log('<span style=color:#f87171>React FAILED to load</span>')"></script>
<script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js" onload="log('ReactDOM loaded')" onerror="log('<span style=color:#f87171>ReactDOM FAILED to load</span>')"></script>
<script>
// STEP 3: Verify and launch
log("Checking globals...");
if(typeof React==="undefined"){log("<span style='color:#f87171'>React is undefined!</span>")}
else if(typeof ReactDOM==="undefined"){log("<span style='color:#f87171'>ReactDOM is undefined!</span>")}
else{
  log("<span style='color:#34d399'>All libraries ready. Launching app...</span>");
  setTimeout(function(){
    document.getElementById("status").style.display="none";
    document.getElementById("root").style.display="block";
    try{launchApp()}catch(e){
      document.getElementById("status").style.display="block";
      document.getElementById("root").style.display="none";
      log("<span style='color:#f87171'>Launch error: "+e.message+"</span>")
    }
  },100)
}

function launchApp(){
var h=React.createElement,us=React.useState,ue=React.useEffect,uc=React.useCallback,um=React.useMemo;

var fmt=function(n){if(n==null||isNaN(n))return"$0.00";var a=Math.abs(n),s=a.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});return n<0?"-$"+s:"$"+s};
var pct=function(n){return((n||0)*100).toFixed(1)+"%"};
var uid=function(){return Date.now().toString(36)+Math.random().toString(36).slice(2,7)};
var dFmt=function(d){return new Date(d+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})};
var mIdx=function(d){return new Date(d+"T12:00:00").getMonth()};
var MN=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
var td=function(){var d=new Date();return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0")};
var CATS=["Activities","Bets","Car Payment","Cars","Doctor","Food","Fun","Games","Gas","Gifts","Insurance","Personal","Phone","Shopping","Subscriptions","Wins/Losses"];
var FIX=["Subscriptions","Insurance","Car Payment","Phone","Fixed","Gas"];
var DSC=["Activities","Bets","Cars","Doctor","Food","Fun","Games","Gifts","Personal","Shopping"];
var SC=["Subscriptions","Insurance","Car Payment","Phone","Gas","Fixed"];
var T={bg:"#09090b",s1:"#18181b",s2:"#27272a",s3:"#3f3f46",b:"#27272a",bSub:"#1c1c1f",w:"#fafafa",w2:"#a1a1aa",w3:"#71717a",w4:"#52525b",blue:"#60a5fa",green:"#34d399",red:"#f87171",amber:"#fbbf24",purple:"#a78bfa",cyan:"#67e8f9",pink:"#f472b6",orange:"#fb923c",greenDim:"#052e16",redDim:"#450a0a"};
var PCC=["#60a5fa","#34d399","#fbbf24","#f87171","#a78bfa","#67e8f9","#f472b6","#fb923c","#a3e635","#818cf8","#2dd4bf","#e879f9"];
var IK=["k","h","r","b","y"];
var IL={k:"401k",h:"HSA",r:"Roth IRA",b:"Bitcoin",y:"HYSA/CMA"};
var GL={k:"401k",h:"HSA",r:"Roth IRA",b:"Bitcoin",e:"Emergency Fund"};
var GIM={k:"k",h:"h",r:"r",b:"b",e:"y"};
var S_ST={investPcts:{k:0,h:0,r:0,b:0,y:0},goalTargets:{k:0,h:0,r:0,b:0,e:0}};
var S_NW={assets:[{id:"a1",name:"Retirement",bal:0},{id:"a2",name:"Investments",bal:0},{id:"a3",name:"Savings",bal:0},{id:"a4",name:"Checking",bal:0}],liabilities:[{id:"l1",name:"Loans",bal:0},{id:"l2",name:"Credit Card",bal:0}]};
var KY={pc:"bw6-pc",sp:"bw6-sp",st:"bw6-st",sub:"bw6-sub",nw:"bw6-nw",nwh:"bw6-nwh",init:"bw6-init"};

function ld(){
  try{
    if(!localStorage.getItem(KY.init)){
      localStorage.setItem(KY.pc,"[]");localStorage.setItem(KY.sp,"[]");
      localStorage.setItem(KY.st,JSON.stringify(S_ST));localStorage.setItem(KY.sub,"[]");
      localStorage.setItem(KY.nw,JSON.stringify(S_NW));localStorage.setItem(KY.nwh,"[]");
      localStorage.setItem(KY.init,"1");
      return{pc:[],sp:[],st:S_ST,sub:[],nw:S_NW,nwh:[]}
    }
    function g(k,fb){try{var v=localStorage.getItem(k);return v?JSON.parse(v):fb}catch(e){return fb}}
    return{pc:g(KY.pc,[]),sp:g(KY.sp,[]),st:g(KY.st,S_ST),sub:g(KY.sub,[]),nw:g(KY.nw,S_NW),nwh:g(KY.nwh,[])}
  }catch(e){return{pc:[],sp:[],st:S_ST,sub:[],nw:S_NW,nwh:[]}}
}
function sv(k,d){try{localStorage.setItem(k,JSON.stringify(d))}catch(e){}}

/* Donut chart */
function Donut(p){var data=p.data||[],colors=p.colors||PCC,sz=p.size||160,inn=p.inner||0.55;var tot=0;for(var i=0;i<data.length;i++)tot+=data[i].value;if(tot===0)return null;var cx=sz/2,cy=sz/2,R=sz/2-4,ri=R*inn,ang=-Math.PI/2;var paths=[];for(var i=0;i<data.length;i++){var fr=data[i].value/tot,a1=ang,a2=ang+fr*Math.PI*2;ang=a2;var gap=data.length>1?0.02:0;var dd="M"+(cx+R*Math.cos(a1+gap))+","+(cy+R*Math.sin(a1+gap))+" A"+R+","+R+" 0 "+(fr>0.5?1:0)+" 1 "+(cx+R*Math.cos(a2-gap))+","+(cy+R*Math.sin(a2-gap))+" L"+(cx+ri*Math.cos(a2-gap))+","+(cy+ri*Math.sin(a2-gap))+" A"+ri+","+ri+" 0 "+(fr>0.5?1:0)+" 0 "+(cx+ri*Math.cos(a1+gap))+","+(cy+ri*Math.sin(a1+gap))+" Z";paths.push(h("path",{key:i,d:dd,fill:colors[i%colors.length]}))}return h("div",{style:{display:"flex",justifyContent:"center",padding:"8px 0"}},h("svg",{width:sz,height:sz},paths))}

/* Bar chart */
function BarC(p){var data=p.data||[],keys=p.keys||[],colors=p.colors||[T.blue,T.green,T.orange],ht=p.height||160;if(data.length===0)return null;var mx=0;for(var i=0;i<data.length;i++)for(var j=0;j<keys.length;j++){var v=data[i][keys[j]]||0;if(v>mx)mx=v}if(mx===0)mx=1;var gW=80/data.length,bW=Math.min(gW/(keys.length+0.5),12);var els=[];for(var i=0;i<data.length;i++){var gx=10+i*gW+gW/2;for(var j=0;j<keys.length;j++){var bh=(data[i][keys[j]]||0)/mx*70;els.push(h("rect",{key:i+"-"+j,x:(gx-keys.length*bW/2+j*bW)+"%",y:(80-bh)+"%",width:bW+"%",height:bh+"%",fill:colors[j%colors.length],rx:1}))}els.push(h("text",{key:"t"+i,x:gx+"%",y:"95%",fill:T.w4,fontSize:9,textAnchor:"middle"},data[i].name))}var leg=null;if(p.legend){var items=[];for(var j=0;j<keys.length;j++)items.push(h("div",{key:j,style:{display:"flex",alignItems:"center",gap:4}},h("div",{style:{width:8,height:8,borderRadius:2,background:colors[j]}}),h("span",{style:{fontSize:11,color:T.w3}},keys[j])));leg=h("div",{style:{display:"flex",gap:16,justifyContent:"center",marginTop:4}},items)}return h("div",{style:{padding:"8px 0"}},h("svg",{width:"100%",height:ht,viewBox:"0 0 100 100",preserveAspectRatio:"none"},h("line",{x1:"10%",y1:"80%",x2:"90%",y2:"80%",stroke:T.b,strokeWidth:0.3}),els),leg)}

/* Line chart */
function LineC(p){var data=p.data||[],keys=p.keys||[],colors=p.colors||[T.w,T.red,T.green],ht=p.height||160;if(data.length<2)return null;var all=[];for(var i=0;i<data.length;i++)for(var j=0;j<keys.length;j++){var v=data[i][keys[j]];if(v!=null)all.push(v)}var mn=Math.min.apply(null,all),mx=Math.max.apply(null,all);if(mn===mx){mn-=1;mx+=1}var pd=(mx-mn)*0.1;mn-=pd;mx+=pd;var els=[];for(var ki=0;ki<keys.length;ki++){var pts=[];for(var di=0;di<data.length;di++){pts.push((10+di/(data.length-1)*80)+","+(80-(data[di][keys[ki]]-mn)/(mx-mn)*70))}if(p.filled)els.push(h("polygon",{key:"f"+ki,points:"10,80 "+pts.join(" ")+" 90,80",fill:colors[ki%colors.length],fillOpacity:0.12}));els.push(h("polyline",{key:"l"+ki,points:pts.join(" "),fill:"none",stroke:colors[ki%colors.length],strokeWidth:0.8}));for(var pi=0;pi<pts.length;pi++){var xy=pts[pi].split(",");els.push(h("circle",{key:"c"+ki+"-"+pi,cx:xy[0]+"%",cy:xy[1]+"%",r:"1%",fill:colors[ki%colors.length]}))}}for(var di=0;di<data.length;di++){els.push(h("text",{key:"lb"+di,x:(10+di/(data.length-1)*80)+"%",y:"95%",fill:T.w4,fontSize:9,textAnchor:"middle"},data[di].name))}var leg=null;if(p.legend){var items=[];for(var j=0;j<keys.length;j++)items.push(h("div",{key:j,style:{display:"flex",alignItems:"center",gap:4}},h("div",{style:{width:8,height:8,borderRadius:2,background:colors[j]}}),h("span",{style:{fontSize:11,color:T.w3}},keys[j])));leg=h("div",{style:{display:"flex",gap:14,justifyContent:"center",marginTop:4,flexWrap:"wrap"}},items)}return h("div",{style:{padding:"8px 0"}},h("svg",{width:"100%",height:ht,viewBox:"0 0 100 100",preserveAspectRatio:"none"},h("line",{x1:"10%",y1:"80%",x2:"90%",y2:"80%",stroke:T.b,strokeWidth:0.3}),els),leg)}

/* UI primitives */
var iS={width:"100%",padding:"12px 14px",borderRadius:10,border:"1px solid "+T.b,background:T.bg,color:T.w,fontSize:16,fontFamily:"inherit",boxSizing:"border-box",outline:"none",WebkitAppearance:"none",minHeight:48};
function bS(c,o,sm,fl){return{padding:sm?"8px 14px":"14px 18px",borderRadius:10,border:o?"1.5px solid "+c:"none",background:o?"transparent":c,color:o?c:"#fff",fontSize:sm?12:14,fontWeight:600,cursor:"pointer",width:fl?"100%":"auto",fontFamily:"inherit",minHeight:sm?36:48,touchAction:"manipulation"}}
function Inp(p){return h("div",{style:Object.assign({marginBottom:14},p.sx||{})},p.label?h("div",{style:{fontSize:11,color:T.w3,fontWeight:600,marginBottom:5,letterSpacing:0.8,textTransform:"uppercase"}},p.label):null,h("input",{value:p.value,onChange:function(e){p.onChange(e.target.value)},type:p.type||"text",placeholder:p.ph,step:p.type==="number"?"any":undefined,style:iS}))}
function Sel(p){return h("div",{style:{marginBottom:14}},p.label?h("div",{style:{fontSize:11,color:T.w3,fontWeight:600,marginBottom:5,letterSpacing:0.8,textTransform:"uppercase"}},p.label):null,h("select",{value:p.value,onChange:function(e){p.onChange(e.target.value)},style:Object.assign({},iS,{WebkitAppearance:"none"})},p.opts.map(function(o){return h("option",{key:o,value:o},o)})))}
function Cd(p){return h("div",{onClick:p.onClick,style:Object.assign({background:T.s1,borderRadius:14,padding:18,border:"1px solid "+T.bSub},p.sx||{})},p.children)}
function SH(p){return h("div",{style:{fontSize:11,fontWeight:700,color:T.w4,textTransform:"uppercase",letterSpacing:1.8,marginBottom:10,marginTop:14}},p.children)}
function PB(p){var pv=Math.min(Math.max(p.p||0,0),1);return h("div",{style:{width:"100%",height:p.h||6,background:T.s2,borderRadius:p.h||6,overflow:"hidden"}},h("div",{style:{width:pv*100+"%",height:"100%",background:p.color,borderRadius:p.h||6,transition:"width .6s"}}))}

function Modal(p){var s1=us(0),dy=s1[0],setDy=s1[1];var s2=us(null),sy=s2[0],setSy=s2[1];if(!p.open)return null;return h("div",{style:{position:"fixed",inset:0,zIndex:1000,display:"flex",alignItems:"flex-end",justifyContent:"center"},onClick:p.onClose},h("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(4px)"}}),h("div",{onClick:function(e){e.stopPropagation()},onTouchStart:function(e){setSy(e.touches[0].clientY)},onTouchMove:function(e){if(sy!=null)setDy(Math.max(0,e.touches[0].clientY-sy))},onTouchEnd:function(){if(dy>120)p.onClose();setDy(0);setSy(null)},style:{position:"relative",width:"100%",maxWidth:480,maxHeight:"88vh",background:T.s1,borderRadius:"20px 20px 0 0",padding:"22px 20px 34px",overflowY:"auto",WebkitOverflowScrolling:"touch",transform:"translateY("+dy+"px)",transition:dy?"none":"transform .3s"}},h("div",{style:{width:36,height:4,background:T.s3,borderRadius:2,margin:"0 auto 18px"}}),h("div",{style:{fontSize:18,fontWeight:700,marginBottom:18}},p.title),p.children))}

/* Error Boundary */
var EB=function(p){return p.children};
try{
  var EBClass=function(){};
  EBClass.prototype=Object.create(React.Component.prototype);
  EBClass.prototype.constructor=EBClass;
  EBClass.prototype.render=function(){if(this.state&&this.state.error)return h("div",{style:{padding:40,color:T.red,background:T.bg,minHeight:"100vh"}},h("b",null,"Render Error:"),h("br"),this.state.error.message,h("br"),h("br"),h("button",{onClick:function(){window.location.reload()},style:bS(T.blue)},"Reload"));return this.props.children};
  EBClass.getDerivedStateFromError=function(error){return{error:error}};
  EB=EBClass;
}catch(e){}

/* ═══ MAIN APP ═══ */
function App(){
  var s0=us(true),loading=s0[0],setL=s0[1];
  var s1=us(0),tab=s1[0],setTab=s1[1];
  var s2=us([]),pc=s2[0],setPc=s2[1];
  var s3=us([]),sp=s3[0],setSp=s3[1];
  var s4=us(S_ST),st=s4[0],setSt=s4[1];
  var s5=us([]),sub=s5[0],setSub=s5[1];
  var s6=us(S_NW),nw=s6[0],setNw=s6[1];
  var s7=us([]),nwh=s7[0],setNwh=s7[1];
  var s8=us(null),modal=s8[0],setModal=s8[1];

  ue(function(){var d=ld();setPc(d.pc);setSp(d.sp);setSt(d.st);setSub(d.sub);setNw(d.nw);setNwh(d.nwh);setL(false)},[]);

  var sPC=uc(function(d){setPc(d);sv(KY.pc,d)},[]);
  var sSP=uc(function(d){setSp(d);sv(KY.sp,d)},[]);
  var sST=uc(function(d){setSt(d);sv(KY.st,d)},[]);
  var sSUB=uc(function(d){setSub(d);sv(KY.sub,d)},[]);
  var sNW=uc(function(d){setNw(d);sv(KY.nw,d)},[]);
  var sNWH=uc(function(d){setNwh(d);sv(KY.nwh,d)},[]);

  var ppData=um(function(){var sorted=pc.slice().sort(function(a,b){return a.date<b.date?-1:1});var noWL=sp.filter(function(s){return s.cat!=="Wins/Losses"});var allP=sorted.map(function(p){return p.period});var run=0;return sorted.map(function(p,i){var ps=noWL.filter(function(s){if(s.pid>0){if(allP.indexOf(s.pid)>=0)return s.pid===p.period;return i===sorted.length-1}var st2=i===0?"2000-01-01":p.date;var en=i<sorted.length-1?sorted[i+1].date:"2099-12-31";return s.date>=st2&&s.date<en});var fixS=0,discS=0;for(var j=0;j<ps.length;j++){if(FIX.indexOf(ps[j].cat)>=0)fixS+=ps[j].amt;if(DSC.indexOf(ps[j].cat)>=0)discS+=ps[j].amt}var totI=0;for(var j=0;j<IK.length;j++)totI+=(p.inv[IK[j]]||0);var dB=p.gross-totI-fixS;if(i>0)run=run+dB-discS;return Object.assign({},p,{fixS:fixS,discS:discS,totalSpend:fixS+discS,totInv:totI,discBudget:dB,discRemaining:run,periodSpend:ps})})},[pc,sp]);

  var D=um(function(){var aPC=pc.filter(function(p){return p.gross>0});var gYTD=0;for(var i=0;i<aPC.length;i++)gYTD+=aPC[i].gross;var inv={k:0,h:0,r:0,b:0,y:0};for(var i=0;i<aPC.length;i++)for(var j=0;j<IK.length;j++)inv[IK[j]]+=(aPC[i].inv[IK[j]]||0);var tInv=0;for(var j=0;j<IK.length;j++)tInv+=inv[IK[j]];var noWL=sp.filter(function(s){return s.cat!=="Wins/Losses"});var tSp=0;for(var i=0;i<noWL.length;i++)tSp+=noWL[i].amt;var byCat={};for(var i=0;i<noWL.length;i++){byCat[noWL[i].cat]=(byCat[noWL[i].cat]||0)+noWL[i].amt}var catArr=Object.entries(byCat).sort(function(a,b){return b[1]-a[1]}).map(function(e){return{cat:e[0],total:e[1],pct:tSp>0?e[1]/tSp:0}});var monthly=[];for(var mi=0;mi<12;mi++){var mS=noWL.filter(function(e){return mIdx(e.date)===mi});var mP=aPC.filter(function(p){return mIdx(p.date)===mi});var inc=0;for(var i=0;i<mP.length;i++)inc+=mP[i].gross;var invested=0;for(var i=0;i<mP.length;i++)for(var j=0;j<IK.length;j++)invested+=(mP[i].inv[IK[j]]||0);var fix=0,disc=0;for(var i=0;i<mS.length;i++){if(FIX.indexOf(mS[i].cat)>=0)fix+=mS[i].amt;if(DSC.indexOf(mS[i].cat)>=0)disc+=mS[i].amt}monthly.push({month:MN[mi],income:inc,invested:invested,fixed:fix,disc:disc,total:fix+disc,cf:inc-invested-fix-disc})}var wl=0;var wlItems=sp.filter(function(s){return s.cat==="Wins/Losses"});for(var i=0;i<wlItems.length;i++)wl+=wlItems[i].amt;var tA=0;for(var i=0;i<nw.assets.length;i++)tA+=nw.assets[i].bal;var tL=0;for(var i=0;i<nw.liabilities.length;i++)tL+=nw.liabilities[i].bal;var dR=ppData.length>0?ppData[ppData.length-1].discRemaining:0;return{gYTD:gYTD,inv:inv,tInv:tInv,tSp:tSp,sRate:gYTD>0?tInv/gYTD:0,catArr:catArr,monthly:monthly,wl:wl,tA:tA,tL:tL,netW:tA-tL,dR:dR,nCF:gYTD-tInv-tSp}},[pc,sp,nw,ppData]);

  function addPC(d){sPC(pc.concat([Object.assign({},d,{id:uid()})]).sort(function(a,b){return a.date<b.date?-1:1}))}
  function editPC(id,u){sPC(pc.map(function(p){return p.id===id?Object.assign({},p,u):p}))}
  function delPC(id){sPC(pc.filter(function(p){return p.id!==id}))}
  function addSP(d){sSP(sp.concat([Object.assign({},d,{id:uid()})]))}
  function editSP(id,u){sSP(sp.map(function(e){return e.id===id?Object.assign({},e,u):e}))}
  function delSP(id){sSP(sp.filter(function(e){return e.id!==id}))}
  function expJSON(){var b=new Blob([JSON.stringify({paychecks:pc,spending:sp,settings:st,subscriptions:sub,netWorth:nw,netWorthHistory:nwh},null,2)],{type:"application/json"});var u=URL.createObjectURL(b);var a=document.createElement("a");a.href=u;a.download="budget-"+td()+".json";a.click();URL.revokeObjectURL(u)}
  function expCSV(){var rows=[["Date","Category","Amount","Note"]];var sorted=sp.filter(function(s){return s.cat!=="Wins/Losses"}).sort(function(a,b){return a.date<b.date?-1:1});for(var i=0;i<sorted.length;i++)rows.push([sorted[i].date,sorted[i].cat,sorted[i].amt,sorted[i].note||""]);var csv="";for(var i=0;i<rows.length;i++)csv+=rows[i].join(",")+"\n";var b=new Blob([csv],{type:"text/csv"});var u=URL.createObjectURL(b);var a=document.createElement("a");a.href=u;a.download="spending-"+td()+".csv";a.click();URL.revokeObjectURL(u)}
  function saveNWH(up){sNW(up);var tA=0,tL=0;for(var i=0;i<up.assets.length;i++)tA+=up.assets[i].bal;for(var i=0;i<up.liabilities.length;i++)tL+=up.liabilities[i].bal;sNWH(nwh.filter(function(x){return x.date!==td()}).concat([{date:td(),assets:tA,liabilities:tL,net:tA-tL}]).sort(function(a,b){return a.date<b.date?-1:1}))}

  var tabs=["Overview","Monthly","Periods","Spending","Goals","Bills","Net Worth","Settings"];

  if(loading)return h("div",{style:{minHeight:"100vh",background:T.bg,display:"flex",alignItems:"center",justifyContent:"center"}},h("div",{style:{color:T.w3}},"Loading..."));

  var tabContent=null;
  if(tab===0)tabContent=h(OvTab,{D:D,st:st});
  else if(tab===1)tabContent=h(MoTab,{D:D,pc:pc,sm:setModal});
  else if(tab===2)tabContent=h(PPTab,{pp:ppData,sm:setModal});
  else if(tab===3)tabContent=h(SpTab,{D:D,sp:sp,sm:setModal});
  else if(tab===4)tabContent=h(GoTab,{D:D,st:st});
  else if(tab===5)tabContent=h(BiTab,{sub:sub,sm:setModal});
  else if(tab===6)tabContent=h(NWTab,{nw:nw,D:D,nwh:nwh,sm:setModal});
  else tabContent=h(SeTab,{st:st,sST:sST,ej:expJSON,ec:expCSV});

  var tabBtns=[];
  for(var i=0;i<tabs.length;i++){(function(idx){tabBtns.push(h("button",{key:idx,onClick:function(){setTab(idx)},style:{padding:"10px 14px",borderRadius:8,border:"none",fontSize:12,fontWeight:600,cursor:"pointer",flexShrink:0,background:tab===idx?T.w:"transparent",color:tab===idx?T.bg:T.w4,fontFamily:"inherit",minHeight:44}},tabs[idx]))})(i)}

  return h("div",{style:{minHeight:"100vh",background:T.bg,color:T.w,fontFamily:"-apple-system,BlinkMacSystemFont,system-ui,sans-serif",maxWidth:480,margin:"0 auto",paddingBottom:80}},
    h("div",{style:{padding:"24px 20px 10px",position:"sticky",top:0,background:T.bg,zIndex:100}},
      h("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"}},
        h("div",null,h("div",{style:{fontSize:20,fontWeight:700}},"Budget"),h("div",{style:{fontSize:12,color:T.w4,marginTop:2}},"v6")),
        h("div",{style:{display:"flex",gap:8}},
          h("button",{style:Object.assign({},bS(T.green,false,true),{padding:"10px 16px"}),onClick:function(){setModal("addPC")}},"+Pay"),
          h("button",{style:Object.assign({},bS(T.s3,false,true),{padding:"10px 16px",color:T.w2}),onClick:function(){setModal("addSP")}},"+Spend")))),
    h("div",{style:{display:"flex",gap:6,padding:"8px 20px 6px",overflowX:"auto",scrollbarWidth:"none"}},tabBtns),
    h("div",{style:{padding:"12px 20px 20px"}},tabContent),
    h(APCM,{open:modal==="addPC",onClose:function(){setModal(null)},onSave:function(d){addPC(d);setModal(null)},st:st,nextP:pc.length>0?Math.max.apply(null,pc.map(function(p){return p.period}))+1:1}),
    h(EPCM,{open:modal&&modal.t==="ePC",data:modal&&modal.t==="ePC"?modal.d:null,onClose:function(){setModal(null)},onSave:function(id,u){editPC(id,u);setModal(null)},onDel:function(id){delPC(id);setModal(null)}}),
    h(ASPM,{open:modal==="addSP",onClose:function(){setModal(null)},onSave:function(d){addSP(d);setModal(null)},pc:pc}),
    h(ESPM,{open:modal&&modal.t==="eSP",data:modal&&modal.t==="eSP"?modal.d:null,onClose:function(){setModal(null)},onSave:function(id,u){editSP(id,u);setModal(null)},onDel:function(id){delSP(id);setModal(null)},pc:pc}),
    h(ASuM,{open:modal==="addSub",onClose:function(){setModal(null)},onSave:function(d){sSUB(sub.concat([Object.assign({},d,{id:uid()})]));setModal(null)}}),
    h(ESuM,{open:modal&&modal.t==="eSub",data:modal&&modal.t==="eSub"?modal.d:null,onClose:function(){setModal(null)},onSave:function(id,u){sSUB(sub.map(function(s){return s.id===id?Object.assign({},s,u):s}));setModal(null)},onDel:function(id){sSUB(sub.filter(function(s){return s.id!==id}));setModal(null)}}),
    h(ENWM,{open:modal&&modal.t==="eNW",items:modal&&modal.t==="eNW"?modal.items:null,kind:modal&&modal.t==="eNW"?modal.kind:null,onClose:function(){setModal(null)},onSave:function(u){saveNWH(u);setModal(null)},nw:nw})
  )
}

/* MODALS */
function APCM(p){var s1=us(td()),date=s1[0],setDate=s1[1];var s2=us(""),gross=s2[0],setGross=s2[1];var s3=us(true),auto=s3[0],setAuto=s3[1];var s4=us({k:"",h:"",r:"",b:"",y:""}),inv=s4[0],setInv=s4[1];ue(function(){if(p.open){setDate(td());setGross("");setAuto(true);setInv({k:"",h:"",r:"",b:"",y:""})}},[p.open]);var g=parseFloat(gross)||0;var fI={};for(var j=0;j<IK.length;j++){var k=IK[j];fI[k]=auto?+(g*(p.st.investPcts[k]||0)).toFixed(2):parseFloat(inv[k])||0}var tI=0;for(var j=0;j<IK.length;j++)tI+=fI[IK[j]];var invRows=[];for(var j=0;j<IK.length;j++){var k=IK[j];invRows.push(h("div",{key:k,style:{display:"flex",justifyContent:"space-between",padding:"4px 0",fontSize:13,color:T.w3}},h("span",null,IL[k]),h("span",{style:{color:T.green,fontWeight:600}},fmt(fI[k]))))}var invInputs=[];if(!auto){for(var j=0;j<IK.length;j++){(function(k){invInputs.push(h(Inp,{key:k,label:IL[k],value:inv[k],onChange:function(v){var n=Object.assign({},inv);n[k]=v;setInv(n)},type:"number",ph:"0.00"}))})(IK[j])}}return h(Modal,{open:p.open,onClose:p.onClose,title:"Add Paycheck"},h(Inp,{label:"Date",value:date,onChange:setDate,type:"date"}),h(Inp,{label:"Gross Pay",value:gross,onChange:setGross,type:"number",ph:"0.00"}),h("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:14}},h("input",{type:"checkbox",checked:auto,onChange:function(){setAuto(!auto)},style:{accentColor:T.blue}}),h("span",{style:{fontSize:13,color:T.w3}},"Auto-calculate from %")),!auto?h("div",{style:{background:T.bg,borderRadius:12,padding:14,marginBottom:14}},invInputs):null,g>0?h(Cd,{sx:{marginBottom:16,background:T.bg}},invRows,h("div",{style:{borderTop:"1px solid "+T.b,marginTop:8,paddingTop:8,display:"flex",justifyContent:"space-between",fontSize:13,fontWeight:700}},h("span",null,"Invested"),h("span",{style:{color:T.green}},fmt(tI))),h("div",{style:{display:"flex",justifyContent:"space-between",fontSize:13,color:T.amber,marginTop:4}},h("span",null,"Remaining"),h("span",null,fmt(g-tI)))):null,h("button",{style:bS(T.green,false,false,true),onClick:function(){if(date&&g>=0)p.onSave({date:date,period:p.nextP,gross:g,inv:fI})}},"Save Paycheck"))}

function EPCM(p){var s1=us(""),date=s1[0],setDate=s1[1];var s2=us(""),gross=s2[0],setGross=s2[1];var s3=us({k:"",h:"",r:"",b:"",y:""}),inv=s3[0],setInv=s3[1];ue(function(){if(p.data){setDate(p.data.date);setGross(String(p.data.gross));var i={};for(var j=0;j<IK.length;j++)i[IK[j]]=String(p.data.inv[IK[j]]||0);setInv(i)}},[p.data]);if(!p.data)return null;var invInputs=[];for(var j=0;j<IK.length;j++){(function(k){invInputs.push(h(Inp,{key:k,label:IL[k],value:inv[k],onChange:function(v){var n=Object.assign({},inv);n[k]=v;setInv(n)},type:"number"}))})(IK[j])}return h(Modal,{open:p.open,onClose:p.onClose,title:"Edit Paycheck"},h(Inp,{label:"Date",value:date,onChange:setDate,type:"date"}),h(Inp,{label:"Gross",value:gross,onChange:setGross,type:"number"}),h("div",{style:{background:T.bg,borderRadius:12,padding:14,marginBottom:14}},invInputs),h("div",{style:{display:"flex",gap:10}},h("button",{style:bS(T.red,true,false,true),onClick:function(){p.onDel(p.data.id)}},"Delete"),h("button",{style:bS(T.green,false,false,true),onClick:function(){var fi={};for(var j=0;j<IK.length;j++)fi[IK[j]]=parseFloat(inv[IK[j]])||0;p.onSave(p.data.id,{date:date,gross:parseFloat(gross)||0,inv:fi})}},"Save")))}

function ASPM(p){var s1=us(td()),date=s1[0],setDate=s1[1];var s2=us("Food"),cat=s2[0],setCat=s2[1];var s3=us(""),amt=s3[0],setAmt=s3[1];var s4=us(""),note=s4[0],setNote=s4[1];var s5=us(0),pid=s5[0],setPid=s5[1];ue(function(){if(p.open){setDate(td());setCat("Food");setAmt("");setNote("");setPid(p.pc.length>0?Math.max.apply(null,p.pc.map(function(x){return x.period})):0)}},[p.open,p.pc]);var periods=p.pc.map(function(x){return x.period}).sort(function(a,b){return b-a});return h(Modal,{open:p.open,onClose:p.onClose,title:"Add Spending"},h(Inp,{label:"Date",value:date,onChange:setDate,type:"date"}),h(Sel,{label:"Category",value:cat,onChange:setCat,opts:CATS}),h(Inp,{label:"Amount",value:amt,onChange:setAmt,type:"number",ph:"0.00"}),periods.length>0?h(Sel,{label:"Pay Period",value:pid,onChange:function(v){setPid(parseInt(v))},opts:periods.map(String)}):null,h(Inp,{label:"Note (optional)",value:note,onChange:setNote,ph:"What was this for?"}),h("button",{style:bS(T.green,false,false,true),onClick:function(){if(parseFloat(amt)&&date)p.onSave({date:date,cat:cat,amt:parseFloat(amt),note:note,pid:pid})}},"Add Entry"))}

function ESPM(p){var s1=us(""),date=s1[0],setDate=s1[1];var s2=us("Food"),cat=s2[0],setCat=s2[1];var s3=us(""),amt=s3[0],setAmt=s3[1];var s4=us(""),note=s4[0],setNote=s4[1];var s5=us(0),pid=s5[0],setPid=s5[1];ue(function(){if(p.data){setDate(p.data.date);setCat(p.data.cat);setAmt(String(p.data.amt));setNote(p.data.note||"");setPid(p.data.pid||0)}},[p.data]);if(!p.data)return null;var periods=p.pc.map(function(x){return x.period}).sort(function(a,b){return b-a});return h(Modal,{open:p.open,onClose:p.onClose,title:"Edit Entry"},h(Inp,{label:"Date",value:date,onChange:setDate,type:"date"}),h(Sel,{label:"Category",value:cat,onChange:setCat,opts:CATS}),h(Inp,{label:"Amount",value:amt,onChange:setAmt,type:"number"}),periods.length>0?h(Sel,{label:"Pay Period",value:pid,onChange:function(v){setPid(parseInt(v))},opts:periods.map(String).concat(["0"])}):null,h(Inp,{label:"Note",value:note,onChange:setNote}),h("div",{style:{display:"flex",gap:10}},h("button",{style:bS(T.red,true,false,true),onClick:function(){p.onDel(p.data.id)}},"Delete"),h("button",{style:bS(T.green,false,false,true),onClick:function(){p.onSave(p.data.id,{date:date,cat:cat,amt:parseFloat(amt)||0,note:note,pid:pid})}},"Save")))}

function ASuM(p){var s1=us(""),name=s1[0],setName=s1[1];var s2=us(""),cost=s2[0],setCost=s2[1];var s3=us("Subscriptions"),cat=s3[0],setCat=s3[1];ue(function(){if(p.open){setName("");setCost("");setCat("Subscriptions")}},[p.open]);return h(Modal,{open:p.open,onClose:p.onClose,title:"Add Subscription"},h(Inp,{label:"Name",value:name,onChange:setName,ph:"e.g. Netflix"}),h(Inp,{label:"Monthly Cost",value:cost,onChange:setCost,type:"number",ph:"0.00"}),h(Sel,{label:"Category",value:cat,onChange:setCat,opts:SC}),h("button",{style:bS(T.green,false,false,true),onClick:function(){if(name&&parseFloat(cost))p.onSave({name:name,cost:parseFloat(cost),cat:cat})}},"Add"))}

function ESuM(p){var s1=us(""),name=s1[0],setName=s1[1];var s2=us(""),cost=s2[0],setCost=s2[1];var s3=us("Subscriptions"),cat=s3[0],setCat=s3[1];ue(function(){if(p.data){setName(p.data.name);setCost(String(p.data.cost));setCat(p.data.cat)}},[p.data]);if(!p.data)return null;return h(Modal,{open:p.open,onClose:p.onClose,title:"Edit Subscription"},h(Inp,{label:"Name",value:name,onChange:setName}),h(Inp,{label:"Monthly Cost",value:cost,onChange:setCost,type:"number"}),h(Sel,{label:"Category",value:cat,onChange:setCat,opts:SC}),h("div",{style:{display:"flex",gap:10}},h("button",{style:bS(T.red,true,false,true),onClick:function(){p.onDel(p.data.id)}},"Delete"),h("button",{style:bS(T.green,false,false,true),onClick:function(){p.onSave(p.data.id,{name:name,cost:parseFloat(cost)||0,cat:cat})}},"Save")))}

function ENWM(p){var s1=us([]),rows=s1[0],setRows=s1[1];ue(function(){if(p.items)setRows(p.items.map(function(d){return Object.assign({},d,{bal:String(d.bal)})}))},[p.items]);if(!p.items)return null;var rowEls=[];for(var i=0;i<rows.length;i++){(function(idx){rowEls.push(h("div",{key:rows[idx].id||idx,style:{display:"flex",gap:8,marginBottom:10,alignItems:"flex-end"}},h(Inp,{label:idx===0?"Name":null,value:rows[idx].name,onChange:function(v){var n=rows.slice();n[idx]=Object.assign({},n[idx],{name:v});setRows(n)},sx:{flex:1,marginBottom:0}}),h(Inp,{label:idx===0?"Balance":null,value:rows[idx].bal,onChange:function(v){var n=rows.slice();n[idx]=Object.assign({},n[idx],{bal:v});setRows(n)},type:"number",sx:{flex:1,marginBottom:0}}),h("button",{style:Object.assign({},bS(T.red,true,true),{flexShrink:0,height:40}),onClick:function(){setRows(rows.filter(function(_,j){return j!==idx}))}},"X")))})(i)}return h(Modal,{open:p.open,onClose:p.onClose,title:"Edit "+(p.kind==="assets"?"Assets":"Liabilities")},rowEls,h("button",{style:Object.assign({},bS(T.blue,true,true),{marginBottom:16}),onClick:function(){setRows(rows.concat([{id:uid(),name:"",bal:"0"}]))}},"+Add"),h("button",{style:bS(T.green,false,false,true),onClick:function(){var pr=rows.filter(function(r){return r.name}).map(function(r){return Object.assign({},r,{bal:parseFloat(r.bal)||0})});p.onSave(p.kind==="assets"?Object.assign({},p.nw,{assets:pr}):Object.assign({},p.nw,{liabilities:pr}))}},"Save"))}

/* ═══ TAB VIEWS ═══ */
function OvTab(p){var D=p.D,st=p.st;var invArr=[];for(var j=0;j<IK.length;j++)invArr.push({name:IL[IK[j]],ytd:D.inv[IK[j]],pctT:st.investPcts[IK[j]]||0});var invPie=invArr.filter(function(i){return i.ytd>0}).map(function(i){return{name:i.name,value:i.ytd}});var rc=D.dR>=0?T.green:T.red;var invItems=[];for(var i=0;i<invArr.length;i++){var a=D.gYTD>0?invArr[i].ytd/D.gYTD:0;invItems.push(h("div",{key:i,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 0",borderTop:i>0?"1px solid "+T.bSub:"none"}},h("div",{style:{display:"flex",alignItems:"center",gap:8}},h("div",{style:{width:8,height:8,borderRadius:"50%",background:PCC[i]}}),h("span",{style:{fontSize:13}},invArr[i].name)),h("div",{style:{textAlign:"right"}},h("div",{style:{fontSize:14,fontWeight:600}},fmt(invArr[i].ytd)),h("div",{style:{fontSize:11,color:a>=invArr[i].pctT?T.green:T.amber}},pct(a)+" / "+pct(invArr[i].pctT)))))}var topSpend=[];for(var i=0;i<Math.min(6,D.catArr.length);i++){topSpend.push(h("div",{key:i,style:{marginBottom:i<5?12:0}},h("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4}},h("span",{style:{fontSize:13}},D.catArr[i].cat),h("span",{style:{fontSize:13,color:T.w3,fontWeight:600}},fmt(D.catArr[i].total))),h(PB,{p:D.catArr[i].pct,color:PCC[i]})))}var grid=[];var gridData=[["Income",D.gYTD,T.w],["Invested",D.tInv,T.green],["Spent",D.tSp,T.red],["Cash Flow",D.nCF,D.nCF>=0?T.green:T.red]];for(var i=0;i<gridData.length;i++){grid.push(h(Cd,{key:i,sx:{padding:14}},h("div",{style:{fontSize:11,color:T.w4}},gridData[i][0]),h("div",{style:{fontSize:18,fontWeight:700,color:gridData[i][2],marginTop:4}},fmt(gridData[i][1]))))}return h("div",{style:{display:"flex",flexDirection:"column",gap:14}},h(Cd,{sx:{borderColor:(D.dR>=0?T.green:T.red)+"30"}},h("div",{style:{fontSize:11,color:T.w4,fontWeight:600,letterSpacing:1,textTransform:"uppercase"}},"Discretionary Remaining"),h("div",{style:{fontSize:32,fontWeight:800,color:rc,letterSpacing:-1,marginTop:4}},fmt(D.dR)),h("div",{style:{fontSize:12,color:T.w4,marginTop:4}},"Rolling balance across pay periods")),h("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}},grid),h(Cd,null,h("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}},h("span",{style:{fontSize:12,color:T.w3}},"Savings Rate"),h("span",{style:{fontSize:22,fontWeight:800,color:T.green}},pct(D.sRate))),h(PB,{p:D.sRate,color:T.green})),h(SH,null,"Investments"),h(Cd,null,h(Donut,{data:invPie}),invItems),h(SH,null,"Top Spending"),h(Cd,null,topSpend))}

function MoTab(p){var D=p.D,pc=p.pc,sm=p.sm;var active=D.monthly.filter(function(m){return m.income>0||m.total>0});var cd=active.map(function(m){return{name:m.month,Invested:m.invested,Fixed:m.fixed,Disc:m.disc}});var trend=D.monthly.filter(function(m){return m.income>0}).map(function(m){return{name:m.month,Income:+m.income.toFixed(2),Spent:+m.total.toFixed(2),Invested:+m.invested.toFixed(2)}});var cards=[];for(var mi=0;mi<D.monthly.length;mi++){var m=D.monthly[mi];if(m.income===0&&m.total===0)continue;var mPC=pc.filter(function(x){return mIdx(x.date)===mi&&x.gross>0});var gd=[["Income",m.income,T.w],["Invested",m.invested,T.green],["Fixed",m.fixed,T.blue],["Disc.",m.disc,T.orange],["Total",m.total,T.red],["CF",m.cf,m.cf>=0?T.green:T.red]];var gridEls=[];for(var j=0;j<gd.length;j++){gridEls.push(h("div",{key:j,style:{padding:"8px 10px",background:T.bg,borderRadius:10}},h("div",{style:{fontSize:10,color:T.w4}},gd[j][0]),h("div",{style:{fontSize:14,fontWeight:700,color:gd[j][2],marginTop:2}},fmt(gd[j][1]))))}var pcEls=[];for(var j=0;j<mPC.length;j++){(function(x){pcEls.push(h("div",{key:x.id,onClick:function(){sm({t:"ePC",d:x})},style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px",background:T.bg,borderRadius:10,marginBottom:4,cursor:"pointer",minHeight:48}},h("span",{style:{fontSize:12,color:T.w3}},dFmt(x.date)+" PP"+x.period),h("span",{style:{fontSize:13,fontWeight:600,color:T.green}},fmt(x.gross))))})(mPC[j])}cards.push(h(Cd,{key:mi},h("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}},h("span",{style:{fontSize:16,fontWeight:700}},m.month),h("span",{style:{fontSize:11,padding:"3px 10px",borderRadius:20,background:m.total>m.income?T.redDim:T.greenDim,color:m.total>m.income?T.red:T.green,fontWeight:600}},m.total>m.income?"Over":"Under")),h("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}},gridEls),pcEls.length>0?h("div",{style:{marginTop:10}},pcEls):null))}return h("div",{style:{display:"flex",flexDirection:"column",gap:14}},trend.length>1?h(Cd,null,h(SH,null,"Trend"),h(LineC,{data:trend,keys:["Income","Spent","Invested"],colors:[T.w,T.red,T.green],legend:true})):null,cd.length>0?h(Cd,null,h(SH,null,"Breakdown"),h(BarC,{data:cd,keys:["Invested","Fixed","Disc"],colors:[T.green,T.blue,T.orange],legend:true})):null,cards)}

function PPTab(p){var ppD=p.pp,sm=p.sm;var active=ppD.filter(function(x){return x.gross>0});var cd=active.map(function(x){return{name:"PP"+x.period,Budget:+x.discBudget.toFixed(2),Spent:+x.discS.toFixed(2)}});var cd2=active.map(function(x){return{name:"PP"+x.period,Remaining:+x.discRemaining.toFixed(2)}});var cards=[];for(var i=0;i<active.length;i++){(function(pp){var over=pp.discS>pp.discBudget;var gd=[["Invested",pp.totInv,T.green],["Fixed",pp.fixS,T.blue],["Disc Budget",pp.discBudget,T.w],["Disc Spent",pp.discS,T.orange]];var gridEls=[];for(var j=0;j<gd.length;j++){gridEls.push(h("div",{key:j,style:{padding:"8px 10px",background:T.bg,borderRadius:10}},h("div",{style:{fontSize:10,color:T.w4}},gd[j][0]),h("div",{style:{fontSize:14,fontWeight:700,color:gd[j][2],marginTop:2}},fmt(gd[j][1]))))}var txEls=[];for(var j=0;j<pp.periodSpend.length;j++){(function(e,idx){txEls.push(h("div",{key:e.id,onClick:function(){sm({t:"eSP",d:e})},style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 8px",borderTop:idx>0?"1px solid "+T.bSub:"none",cursor:"pointer",fontSize:12,minHeight:44}},h("div",null,h("span",{style:{fontWeight:500}},e.cat),h("span",{style:{color:T.w4,marginLeft:6}},dFmt(e.date))),h("span",{style:{fontWeight:600,color:e.amt<0?T.green:T.w}},fmt(e.amt))))})(pp.periodSpend[j],j)}cards.push(h(Cd,{key:pp.id},h("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}},h("div",{style:{display:"flex",alignItems:"center",gap:8}},h("span",{style:{fontSize:16,fontWeight:700}},"PP"+pp.period),h("span",{style:{fontSize:11,padding:"3px 10px",borderRadius:20,background:over?T.redDim:T.greenDim,color:over?T.red:T.green,fontWeight:600}},over?"Over":"Under")),h("span",{style:{fontSize:12,color:T.w4}},dFmt(pp.date))),h("div",{onClick:function(){sm({t:"ePC",d:pp})},style:{cursor:"pointer",padding:"12px 14px",background:T.bg,borderRadius:10,marginBottom:10,display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:48}},h("span",{style:{fontSize:12,color:T.w3}},"Gross"),h("span",{style:{fontSize:14,fontWeight:700}},fmt(pp.gross))),h("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:10}},gridEls),h("div",{style:{padding:"10px 14px",background:T.bg,borderRadius:10,display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid "+(pp.discRemaining>=0?T.green:T.red)+"20"}},h("span",{style:{fontSize:12,color:T.w3}},"Running Remaining"),h("span",{style:{fontSize:18,fontWeight:800,color:pp.discRemaining>=0?T.green:T.red}},fmt(pp.discRemaining))),txEls.length>0?h("details",{style:{marginTop:10}},h("summary",{style:{fontSize:12,color:T.blue,cursor:"pointer",fontWeight:600,minHeight:44,display:"flex",alignItems:"center"}},txEls.length+" transactions"),h("div",{style:{marginTop:6}},txEls)):null))})(active[i])}return h("div",{style:{display:"flex",flexDirection:"column",gap:14}},h(SH,null,"Pay Period Overview"),cd.length>0?h(Cd,null,h(BarC,{data:cd,keys:["Budget","Spent"],colors:[T.blue,T.orange],legend:true}),h(LineC,{data:cd2,keys:["Remaining"],colors:[T.green],filled:true,height:100})):null,cards)}

function SpTab(p){var D=p.D,sp=p.sp,sm=p.sm;var s1=us("All"),filter=s1[0],setFilter=s1[1];var s2=us(""),search=s2[0],setSearch=s2[1];var noWL=sp.filter(function(s){return s.cat!=="Wins/Losses"});var searched=search?noWL.filter(function(e){return(e.cat+" "+(e.note||"")+" "+e.date).toLowerCase().indexOf(search.toLowerCase())>=0}):noWL;var filtered=filter==="All"?searched:searched.filter(function(s){return s.cat===filter});var sorted=filtered.slice().sort(function(a,b){return b.date<a.date?-1:b.date>a.date?1:0});var pieData=D.catArr.filter(function(s){return s.total>0}).map(function(s){return{name:s.cat,value:s.total}});var catLegend=[];var catFiltered=D.catArr.filter(function(s){return s.total>0});for(var i=0;i<catFiltered.length;i++){catLegend.push(h("div",{key:i,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"7px 0",borderTop:i>0?"1px solid "+T.bSub:"none"}},h("div",{style:{display:"flex",alignItems:"center",gap:8}},h("div",{style:{width:8,height:8,borderRadius:2,background:PCC[i]}}),h("span",{style:{fontSize:12}},catFiltered[i].cat)),h("div",null,h("span",{style:{fontSize:13,fontWeight:600}},fmt(catFiltered[i].total)),h("span",{style:{fontSize:11,color:T.w4,marginLeft:6}},pct(catFiltered[i].pct)))))}var allCats=["All"];for(var i=0;i<CATS.length;i++){if(CATS[i]!=="Wins/Losses")allCats.push(CATS[i])}var filterBtns=[];for(var i=0;i<allCats.length;i++){(function(c){filterBtns.push(h("button",{key:c,onClick:function(){setFilter(c)},style:{padding:"8px 14px",borderRadius:8,border:"none",fontSize:12,fontWeight:600,cursor:"pointer",flexShrink:0,background:filter===c?T.w:"transparent",color:filter===c?T.bg:T.w4,fontFamily:"inherit",minHeight:40}},c))})(allCats[i])}var listItems=[];var show=sorted.slice(0,80);for(var i=0;i<show.length;i++){(function(e,idx){listItems.push(h("div",{key:e.id,onClick:function(){sm({t:"eSP",d:e})},style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 10px",borderTop:idx>0?"1px solid "+T.bSub:"none",cursor:"pointer",minHeight:52}},h("div",null,h("div",{style:{fontSize:13,fontWeight:500}},e.cat),h("div",{style:{fontSize:11,color:T.w4}},dFmt(e.date)+(e.note?" · "+e.note:""))),h("span",{style:{fontSize:14,fontWeight:600,color:e.amt<0?T.green:T.w,flexShrink:0,marginLeft:8}},fmt(e.amt))))})(show[i],i)}return h("div",{style:{display:"flex",flexDirection:"column",gap:14}},h("div",{style:{display:"flex",gap:8}},h(Cd,{sx:{flex:1,textAlign:"center",padding:14}},h("div",{style:{fontSize:10,color:T.w4}},"Total Spent"),h("div",{style:{fontSize:18,fontWeight:700,color:T.red,marginTop:2}},fmt(D.tSp))),h(Cd,{sx:{flex:1,textAlign:"center",padding:14}},h("div",{style:{fontSize:10,color:T.w4}},"Wins/Losses"),h("div",{style:{fontSize:18,fontWeight:700,color:D.wl>=0?T.green:T.red,marginTop:2}},fmt(D.wl)))),pieData.length>0?h(Cd,null,h(Donut,{data:pieData}),catLegend):null,h(SH,null,"Log"),h("input",{value:search,onChange:function(e){setSearch(e.target.value)},placeholder:"Search...",style:Object.assign({},iS,{marginBottom:8})}),h("div",{style:{display:"flex",gap:6,overflowX:"auto",scrollbarWidth:"none",paddingBottom:4}},filterBtns),h(Cd,{sx:{padding:10}},sorted.length===0?h("div",{style:{padding:20,textAlign:"center",color:T.w4,fontSize:13}},"No entries"+(search?" matching search":"")):null,listItems))}

function GoTab(p){var D=p.D,st=p.st;var entries=Object.entries(GL);var cards=[];for(var i=0;i<entries.length;i++){var k=entries[i][0],name=entries[i][1],target=st.goalTargets[k]||0,cur=D.inv[GIM[k]]||0,pr=target>0?cur/target:0,col=pr>=1?T.green:pr>=0.25?T.blue:T.red;cards.push(h(Cd,{key:i},h("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:10}},h("div",{style:{fontSize:15,fontWeight:700}},name),h("span",{style:{fontSize:11,color:T.w4,background:T.bg,padding:"3px 10px",borderRadius:8}},pr>=1?"Done":"In Progress")),h(PB,{p:pr,color:col,h:8}),h("div",{style:{display:"flex",justifyContent:"space-between",marginTop:10}},h("div",null,h("div",{style:{fontSize:10,color:T.w4}},"Current"),h("div",{style:{fontSize:15,fontWeight:700,color:col}},fmt(cur))),h("div",{style:{textAlign:"center"}},h("div",{style:{fontSize:10,color:T.w4}},"Progress"),h("div",{style:{fontSize:15,fontWeight:700,color:col}},pct(pr))),h("div",{style:{textAlign:"right"}},h("div",{style:{fontSize:10,color:T.w4}},"Remaining"),h("div",{style:{fontSize:15,fontWeight:700,color:T.w3}},fmt(Math.max(0,target-cur))))),h("div",{style:{fontSize:11,color:T.w4,marginTop:8,textAlign:"center"}},"Target: "+fmt(target))))}return h("div",{style:{display:"flex",flexDirection:"column",gap:14}},h(SH,null,"Savings Goals"),cards)}

function BiTab(p){var sub=p.sub,sm=p.sm;var total=0;for(var i=0;i<sub.length;i++)total+=sub[i].cost;var grouped={};for(var i=0;i<sub.length;i++){var c=sub[i].cat;if(!grouped[c])grouped[c]=[];grouped[c].push(sub[i])}var sections=[];var gk=Object.keys(grouped);for(var gi=0;gi<gk.length;gi++){var cat=gk[gi],items=grouped[cat];var rows=[];for(var i=0;i<items.length;i++){(function(s,idx){rows.push(h("div",{key:s.id,onClick:function(){sm({t:"eSub",d:s})},style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 4px",borderTop:idx>0?"1px solid "+T.bSub:"none",cursor:"pointer",minHeight:48}},h("span",{style:{fontSize:13}},s.name),h("div",{style:{textAlign:"right"}},h("span",{style:{fontSize:14,fontWeight:600}},fmt(s.cost)),h("span",{style:{fontSize:10,color:T.w4}},"/mo"))))})(items[i],i)}sections.push(h(Cd,{key:gi},h("div",{style:{fontSize:11,fontWeight:700,color:T.w4,marginBottom:10,letterSpacing:1,textTransform:"uppercase"}},cat),rows))}return h("div",{style:{display:"flex",flexDirection:"column",gap:14}},h("button",{style:bS(T.s3,false,false,true),onClick:function(){sm("addSub")}},h("span",{style:{color:T.w2}},"+Add Subscription")),h("div",{style:{display:"flex",gap:8}},h(Cd,{sx:{flex:1,textAlign:"center",padding:14}},h("div",{style:{fontSize:10,color:T.w4}},"Monthly"),h("div",{style:{fontSize:18,fontWeight:700,color:T.blue,marginTop:2}},fmt(total))),h(Cd,{sx:{flex:1,textAlign:"center",padding:14}},h("div",{style:{fontSize:10,color:T.w4}},"Annual"),h("div",{style:{fontSize:18,fontWeight:700,color:T.amber,marginTop:2}},fmt(total*12)))),sections)}

function NWTab(p){var nw=p.nw,D=p.D,nwh=p.nwh,sm=p.sm;var aD=nw.assets.filter(function(a){return a.bal>0}).map(function(a){return{name:a.name,value:a.bal}});var lD=nw.liabilities.filter(function(l){return l.bal>0}).map(function(l){return{name:l.name,value:l.bal}});var hist=nwh.map(function(x){return{name:dFmt(x.date),Assets:x.assets,Liabilities:x.liabilities,Net:x.net}});var accts=[["assets",nw.assets,T.green,"Assets"],["liabilities",nw.liabilities,T.red,"Liabilities"]];var acctCards=[];for(var ai=0;ai<accts.length;ai++){(function(x){var rows=[];for(var i=0;i<x[1].length;i++){rows.push(h("div",{key:x[1][i].id,style:{display:"flex",justifyContent:"space-between",padding:"8px 0",borderTop:i>0?"1px solid "+T.bSub:"none"}},h("span",{style:{fontSize:13}},x[1][i].name),h("span",{style:{fontSize:14,fontWeight:600,color:x[1][i].bal>0?x[2]:T.w4}},fmt(x[1][i].bal))))}var tot=0;for(var i=0;i<x[1].length;i++)tot+=x[1][i].bal;acctCards.push(h(Cd,{key:x[0]},h("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}},h("span",{style:{fontSize:12,fontWeight:700,color:x[2]}},x[3]),h("button",{style:bS(x[2],true,true),onClick:function(){sm({t:"eNW",items:x[1],kind:x[0]})}},"Edit")),rows,h("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:8,borderTop:"1px solid "+T.b,marginTop:4}},h("span",{style:{fontWeight:700}},"Total"),h("span",{style:{fontWeight:700,color:x[2]}},fmt(tot)))))})(accts[ai])}return h("div",{style:{display:"flex",flexDirection:"column",gap:14}},h(Cd,{sx:{textAlign:"center"}},h("div",{style:{fontSize:11,color:T.w4,fontWeight:600,letterSpacing:1}},"NET WORTH"),h("div",{style:{fontSize:32,fontWeight:800,color:D.netW>=0?T.green:T.red,letterSpacing:-1,marginTop:4}},fmt(D.netW)),h("div",{style:{display:"flex",justifyContent:"center",gap:28,marginTop:12}},h("div",null,h("div",{style:{fontSize:10,color:T.w4}},"Assets"),h("div",{style:{fontSize:16,fontWeight:700,color:T.green}},fmt(D.tA))),h("div",{style:{width:1,background:T.b}}),h("div",null,h("div",{style:{fontSize:10,color:T.w4}},"Liabilities"),h("div",{style:{fontSize:16,fontWeight:700,color:T.red}},fmt(D.tL))))),hist.length>1?h(Cd,null,h(SH,null,"History"),h(LineC,{data:hist,keys:["Assets","Liabilities","Net"],colors:[T.green,T.red,T.blue],legend:true})):h(Cd,null,h("div",{style:{fontSize:13,color:T.w4,textAlign:"center",padding:10}},"History appears after second update")),h("div",{style:{display:"flex",gap:8}},h(Cd,{sx:{flex:1,padding:10}},h(Donut,{data:aD,colors:[T.green,T.cyan,T.blue,T.purple],size:110,inner:0.5}),h("div",{style:{textAlign:"center",fontSize:11,color:T.green,fontWeight:600}},"Assets")),h(Cd,{sx:{flex:1,padding:10}},h(Donut,{data:lD,colors:[T.red,T.orange,T.pink],size:110,inner:0.5}),h("div",{style:{textAlign:"center",fontSize:11,color:T.red,fontWeight:600}},"Liabilities"))),acctCards)}

function SeTab(p){var st=p.st,sST=p.sST;var s1=us(Object.assign({},st.investPcts)),pcts=s1[0],setPcts=s1[1];var s2=us(Object.assign({},st.goalTargets)),goals=s2[0],setGoals=s2[1];var s3=us(false),saved=s3[0],setSaved=s3[1];var s4=us(false),resetC=s4[0],setResetC=s4[1];function handleSave(){var pr={},g={};for(var j=0;j<IK.length;j++)pr[IK[j]]=parseFloat(pcts[IK[j]])||0;var gk=Object.keys(GL);for(var j=0;j<gk.length;j++)g[gk[j]]=parseFloat(goals[gk[j]])||0;sST({investPcts:pr,goalTargets:g});setSaved(true);setTimeout(function(){setSaved(false)},2000)}function handleReset(){try{var vk=Object.values(KY);for(var i=0;i<vk.length;i++)localStorage.removeItem(vk[i])}catch(e){}window.location.reload()}var totalPct=0;for(var j=0;j<IK.length;j++)totalPct+=parseFloat(pcts[IK[j]])||0;var invRows=[];for(var j=0;j<IK.length;j++){(function(k){invRows.push(h("div",{key:k,style:{display:"flex",alignItems:"center",gap:10,marginBottom:10}},h("span",{style:{fontSize:13,minWidth:80}},IL[k]),h("input",{value:pcts[k],onChange:function(e){var n=Object.assign({},pcts);n[k]=e.target.value;setPcts(n)},type:"number",step:"0.01",style:Object.assign({},iS,{flex:1})}),h("span",{style:{fontSize:11,color:T.w4,minWidth:40}},pct(parseFloat(pcts[k])||0))))})(IK[j])}var goalRows=[];var gk=Object.entries(GL);for(var j=0;j<gk.length;j++){(function(k,label){goalRows.push(h("div",{key:k,style:{display:"flex",alignItems:"center",gap:10,marginBottom:10}},h("span",{style:{fontSize:12,minWidth:110}},label),h("input",{value:goals[k],onChange:function(e){var n=Object.assign({},goals);n[k]=e.target.value;setGoals(n)},type:"number",style:Object.assign({},iS,{flex:1})})))})(gk[j][0],gk[j][1])}return h("div",{style:{display:"flex",flexDirection:"column",gap:14}},h(SH,null,"Investment %"),h(Cd,null,invRows,h("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:8,borderTop:"1px solid "+T.b}},h("span",{style:{fontSize:13,fontWeight:600}},"Total"),h("span",{style:{fontSize:14,fontWeight:700,color:totalPct<=1?T.green:T.red}},pct(totalPct)))),h(SH,null,"Goal Targets"),h(Cd,null,goalRows),h("button",{style:bS(T.green,false,false,true),onClick:handleSave},saved?"Saved!":"Save Settings"),h(SH,null,"Export"),h(Cd,null,h("div",{style:{fontSize:12,color:T.w3,marginBottom:12}},"Download for backup."),h("div",{style:{display:"flex",gap:10}},h("button",{style:bS(T.blue,true,false,true),onClick:p.ej},"JSON"),h("button",{style:bS(T.purple,true,false,true),onClick:p.ec},"CSV"))),h(SH,null,"Reset"),h(Cd,{sx:{borderColor:T.red+"20"}},h("div",{style:{fontSize:12,color:T.w3,marginBottom:10}},"Restore to empty. Cannot be undone."),!resetC?h("button",{style:bS(T.red,true,false,true),onClick:function(){setResetC(true)}},"Reset All Data"):h("div",{style:{display:"flex",gap:10}},h("button",{style:bS(T.s3,true,false,true),onClick:function(){setResetC(false)}},"Cancel"),h("button",{style:bS(T.red,false,false,true),onClick:handleReset},"Confirm"))))}

/* MOUNT */
ReactDOM.createRoot(document.getElementById("root")).render(h(App))

} /* end launchApp */
</script>
</body>
</html>
