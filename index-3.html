<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Budget">
<meta name="theme-color" content="#09090b">
<meta name="mobile-web-app-capable" content="yes">
<title>Budget</title>
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" sizes="180x180" href="icon-180.png">
<link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html{height:100%;overflow:hidden}
body{background:#09090b;overflow-x:hidden;overflow-y:auto;height:100%;-webkit-overflow-scrolling:touch;overscroll-behavior-y:contain}
::-webkit-scrollbar{display:none}
input,select,button,textarea{font-family:-apple-system,BlinkMacSystemFont,'SF Pro Text','Segoe UI',system-ui,sans-serif;font-size:16px}
input[type="date"]::-webkit-calendar-picker-indicator{filter:invert(0.7)}
button{-webkit-user-select:none;user-select:none;touch-action:manipulation}
button:active{opacity:0.7!important;transform:scale(0.97);transition:all 0.08s}
details summary{-webkit-user-select:none;user-select:none;touch-action:manipulation;min-height:44px;display:flex;align-items:center}
select{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath d='M3 5l3 3 3-3' fill='none' stroke='%2371717a' stroke-width='1.5'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;padding-right:32px!important}
@supports(padding:env(safe-area-inset-top)){body{padding-top:env(safe-area-inset-top);padding-bottom:env(safe-area-inset-bottom);padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right)}}
</style>
</head>
<body>
<div id="root"><div style="display:flex;align-items:center;justify-content:center;min-height:100vh;color:#71717a;font-family:system-ui;font-size:14px">Loading...</div></div>
<script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone@7.24.0/babel.min.js"></script>
<script>
window.onerror=function(m,s,l){document.getElementById('root').innerHTML='<div style="padding:40px;color:#f87171;font-family:system-ui;font-size:14px;line-height:1.6"><b>Error:</b><br>'+m+'<br>Line: '+l+'</div>';};
</script>
<script type="text/babel">
var useState=React.useState, useEffect=React.useEffect, useCallback=React.useCallback, useMemo=React.useMemo;

var fmt=function(n){if(n==null||isNaN(n))return"$0.00";var a=Math.abs(n),s=a.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});return n<0?"-$"+s:"$"+s;};
var pct=function(n){return((n||0)*100).toFixed(1)+"%";};
var uid=function(){return Date.now().toString(36)+Math.random().toString(36).slice(2,7);};
var dFmt=function(d){return new Date(d+"T12:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"});};
var mIdx=function(d){return new Date(d+"T12:00:00").getMonth();};
var MN=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
var td=function(){var d=new Date();return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0");};

var CATS=["Activities","Bets","Car Payment","Cars","Doctor","Food","Fun","Games","Gas","Gifts","Insurance","Personal","Phone","Shopping","Subscriptions","Wins/Losses"];
var FIX=["Subscriptions","Insurance","Car Payment","Phone","Fixed","Gas"];
var DSC=["Activities","Bets","Cars","Doctor","Food","Fun","Games","Gifts","Personal","Shopping"];
var SC=["Subscriptions","Insurance","Car Payment","Phone","Gas","Fixed"];
var T={bg:"#09090b",s1:"#18181b",s2:"#27272a",s3:"#3f3f46",b:"#27272a",bSub:"#1c1c1f",w:"#fafafa",w2:"#a1a1aa",w3:"#71717a",w4:"#52525b",blue:"#60a5fa",green:"#34d399",red:"#f87171",amber:"#fbbf24",purple:"#a78bfa",cyan:"#67e8f9",pink:"#f472b6",orange:"#fb923c",greenDim:"#052e16",redDim:"#450a0a"};
var PC=["#60a5fa","#34d399","#fbbf24","#f87171","#a78bfa","#67e8f9","#f472b6","#fb923c","#a3e635","#818cf8","#2dd4bf","#e879f9","#fb7185","#38bdf8","#facc15"];
var IK=["k","h","r","b","y"];
var IL={k:"401k",h:"HSA",r:"Roth IRA",b:"Bitcoin",y:"HYSA/CMA"};
var GL={k:"401k",h:"HSA",r:"Roth IRA",b:"Bitcoin",e:"Emergency Fund"};
var GIM={k:"k",h:"h",r:"r",b:"b",e:"y"};

var S_PC=[];var S_SP=[];
var S_ST={investPcts:{k:0,h:0,r:0,b:0,y:0},goalTargets:{k:0,h:0,r:0,b:0,e:0}};
var S_SUB=[];
var S_NW={assets:[{id:"a1",name:"Retirement",bal:0},{id:"a2",name:"Investments",bal:0},{id:"a3",name:"Savings",bal:0},{id:"a4",name:"Checking",bal:0}],liabilities:[{id:"l1",name:"Loans",bal:0},{id:"l2",name:"Credit Card",bal:0}]};
var S_NWH=[];

var KY={pc:"bw4-pc",sp:"bw4-sp",st:"bw4-st",sub:"bw4-sub",nw:"bw4-nw",nwh:"bw4-nwh",init:"bw4-init"};
function loadAll(){try{var ck=localStorage.getItem(KY.init);if(!ck){localStorage.setItem(KY.pc,JSON.stringify(S_PC));localStorage.setItem(KY.sp,JSON.stringify(S_SP));localStorage.setItem(KY.st,JSON.stringify(S_ST));localStorage.setItem(KY.sub,JSON.stringify(S_SUB));localStorage.setItem(KY.nw,JSON.stringify(S_NW));localStorage.setItem(KY.nwh,JSON.stringify(S_NWH));localStorage.setItem(KY.init,"1");return{pc:S_PC,sp:S_SP,st:S_ST,sub:S_SUB,nw:S_NW,nwh:S_NWH};}function g(k,fb){try{var v=localStorage.getItem(k);return v?JSON.parse(v):fb;}catch(e){return fb;}}return{pc:g(KY.pc,S_PC),sp:g(KY.sp,S_SP),st:g(KY.st,S_ST),sub:g(KY.sub,S_SUB),nw:g(KY.nw,S_NW),nwh:g(KY.nwh,S_NWH)};}catch(e){return{pc:S_PC,sp:S_SP,st:S_ST,sub:S_SUB,nw:S_NW,nwh:S_NWH};}}
function sv(k,d){try{localStorage.setItem(k,JSON.stringify(d));}catch(e){}}

/* SVG Charts */
function DonutChart(props){var data=props.data||[],colors=props.colors||PC,size=props.size||160,inner=props.inner||0.55;var total=data.reduce(function(s,d){return s+d.value;},0);if(total===0)return null;var cx=size/2,cy=size/2,R=size/2-4,r=R*inner,angle=-Math.PI/2;var paths=data.map(function(d,i){var frac=d.value/total,a1=angle,a2=angle+frac*Math.PI*2;angle=a2;var gap=data.length>1?0.02:0;var path="M"+(cx+R*Math.cos(a1+gap))+","+(cy+R*Math.sin(a1+gap))+" A"+R+","+R+" 0 "+(frac>0.5?1:0)+" 1 "+(cx+R*Math.cos(a2-gap))+","+(cy+R*Math.sin(a2-gap))+" L"+(cx+r*Math.cos(a2-gap))+","+(cy+r*Math.sin(a2-gap))+" A"+r+","+r+" 0 "+(frac>0.5?1:0)+" 0 "+(cx+r*Math.cos(a1+gap))+","+(cy+r*Math.sin(a1+gap))+" Z";return <path key={i} d={path} fill={colors[i%colors.length]}/>;});return <div style={{display:"flex",justifyContent:"center",padding:"8px 0"}}><svg width={size} height={size}>{paths}</svg></div>;}

function BarC(props){var data=props.data||[],keys=props.keys||[],colors=props.colors||[T.blue,T.green,T.orange],ht=props.height||180;if(!data.length)return null;var mx=0;data.forEach(function(d){keys.forEach(function(k){if(d[k]>mx)mx=d[k];});});if(mx===0)mx=1;var gW=80/data.length,bW=Math.min(gW/(keys.length+.5),12);var bars=[];data.forEach(function(d,di){var gx=10+di*gW+gW/2;keys.forEach(function(k,ki){var bh=(d[k]||0)/mx*70;bars.push(<rect key={di+"-"+ki} x={(gx-keys.length*bW/2+ki*bW)+"%"} y={(80-bh)+"%"} width={bW+"%"} height={bh+"%"} fill={colors[ki%colors.length]} rx="1"/>);});bars.push(<text key={"l"+di} x={gx+"%"} y="95%" fill={T.w4} fontSize="9" textAnchor="middle">{d.name||""}</text>);});return <div style={{padding:"8px 0"}}><svg width="100%" height={ht} viewBox="0 0 100 100" preserveAspectRatio="none"><line x1="10%" y1="80%" x2="90%" y2="80%" stroke={T.b} strokeWidth="0.3"/>{bars}</svg>{props.legend&&<div style={{display:"flex",gap:16,justifyContent:"center",marginTop:4}}>{keys.map(function(k,i){return <div key={i} style={{display:"flex",alignItems:"center",gap:4}}><div style={{width:8,height:8,borderRadius:2,background:colors[i]}}/><span style={{fontSize:11,color:T.w3}}>{k}</span></div>;})}</div>}</div>;}

function LineC(props){var data=props.data||[],keys=props.keys||[],colors=props.colors||[T.w,T.red,T.green],ht=props.height||180,filled=props.filled;if(data.length<2)return null;var all=[];data.forEach(function(d){keys.forEach(function(k){if(d[k]!=null)all.push(d[k]);});});var mn=Math.min.apply(null,all),mx=Math.max.apply(null,all);if(mn===mx){mn-=1;mx+=1;}var pad=(mx-mn)*0.1;mn-=pad;mx+=pad;var lines=keys.map(function(k,ki){var pts=data.map(function(d,di){return(10+di/(data.length-1)*80)+","+(80-(d[k]-mn)/(mx-mn)*70);});var el=[];if(filled)el.push(<polygon key={"f"+ki} points={"10,80 "+pts.join(" ")+" "+(10+80)+",80"} fill={colors[ki%colors.length]} fillOpacity="0.12"/>);el.push(<polyline key={"l"+ki} points={pts.join(" ")} fill="none" stroke={colors[ki%colors.length]} strokeWidth="0.8" strokeLinejoin="round"/>);pts.forEach(function(p,pi){var xy=p.split(",");el.push(<circle key={"d"+ki+"-"+pi} cx={xy[0]+"%"} cy={xy[1]+"%"} r="1%" fill={colors[ki%colors.length]}/>);});return el;});var labels=data.map(function(d,di){return <text key={"lb"+di} x={(10+di/(data.length-1)*80)+"%"} y="95%" fill={T.w4} fontSize="9" textAnchor="middle">{d.name||""}</text>;});return <div style={{padding:"8px 0"}}><svg width="100%" height={ht} viewBox="0 0 100 100" preserveAspectRatio="none"><line x1="10%" y1="80%" x2="90%" y2="80%" stroke={T.b} strokeWidth="0.3"/>{lines}{labels}</svg>{props.legend&&<div style={{display:"flex",gap:14,justifyContent:"center",marginTop:4,flexWrap:"wrap"}}>{keys.map(function(k,i){return <div key={i} style={{display:"flex",alignItems:"center",gap:4}}><div style={{width:8,height:8,borderRadius:2,background:colors[i]}}/><span style={{fontSize:11,color:T.w3}}>{k}</span></div>;})}</div>}</div>;}

/* UI */
var iS={width:"100%",padding:"12px 14px",borderRadius:10,border:"1px solid "+T.b,background:T.bg,color:T.w,fontSize:16,fontFamily:"inherit",boxSizing:"border-box",outline:"none",WebkitAppearance:"none",minHeight:48};
function bS(c,o,sm,fl,dis){return{padding:sm?"8px 14px":"14px 18px",borderRadius:10,border:o?"1.5px solid "+c:"none",background:o?"transparent":dis?T.s3:c,color:o?c:"#fff",fontSize:sm?12:14,fontWeight:600,cursor:dis?"default":"pointer",opacity:dis?0.4:1,width:fl?"100%":"auto",fontFamily:"inherit",minHeight:sm?36:48,touchAction:"manipulation"};}
function Inp(p){return <div style={Object.assign({marginBottom:14},p.sx||{})}>{p.label&&<div style={{fontSize:11,color:T.w3,fontWeight:600,marginBottom:5,letterSpacing:0.8,textTransform:"uppercase"}}>{p.label}</div>}<input value={p.value} onChange={function(e){p.onChange(e.target.value);}} type={p.type||"text"} placeholder={p.ph} step={p.type==="number"?"any":undefined} style={iS}/></div>;}
function Sel(p){return <div style={{marginBottom:14}}>{p.label&&<div style={{fontSize:11,color:T.w3,fontWeight:600,marginBottom:5,letterSpacing:0.8,textTransform:"uppercase"}}>{p.label}</div>}<select value={p.value} onChange={function(e){p.onChange(e.target.value);}} style={Object.assign({},iS,{WebkitAppearance:"none"})}>{p.opts.map(function(o){return <option key={o} value={o}>{o}</option>;})}</select></div>;}
function Cd(p){return <div onClick={p.onClick} style={Object.assign({background:T.s1,borderRadius:14,padding:18,border:"1px solid "+T.bSub},p.sx||{})}>{p.children}</div>;}
function SH(p){return <div style={{fontSize:11,fontWeight:700,color:T.w4,textTransform:"uppercase",letterSpacing:1.8,marginBottom:10,marginTop:14}}>{p.children}</div>;}
function PB(p){return <div style={{width:"100%",height:p.h||6,background:T.s2,borderRadius:p.h||6,overflow:"hidden"}}><div style={{width:Math.min(Math.max(p.p||0,0),1)*100+"%",height:"100%",background:p.color,borderRadius:p.h||6,transition:"width 0.6s ease"}}/></div>;}

function Modal(p){var _s=useState(0),dy=_s[0],setDy=_s[1];var _s2=useState(null),sY=_s2[0],setSY=_s2[1];if(!p.open)return null;return <div style={{position:"fixed",inset:0,zIndex:1000,display:"flex",alignItems:"flex-end",justifyContent:"center"}} onClick={p.onClose}><div style={{position:"absolute",inset:0,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(4px)"}}/><div onClick={function(e){e.stopPropagation();}} onTouchStart={function(e){setSY(e.touches[0].clientY);}} onTouchMove={function(e){if(sY!==null)setDy(Math.max(0,e.touches[0].clientY-sY));}} onTouchEnd={function(){if(dy>120)p.onClose();setDy(0);setSY(null);}} style={{position:"relative",width:"100%",maxWidth:480,maxHeight:"88vh",background:T.s1,borderRadius:"20px 20px 0 0",padding:"22px 20px 34px",overflowY:"auto",WebkitOverflowScrolling:"touch",transform:"translateY("+dy+"px)",transition:dy?"none":"transform 0.3s ease"}}><div style={{width:36,height:4,background:T.s3,borderRadius:2,margin:"0 auto 18px"}}/><div style={{fontSize:18,fontWeight:700,marginBottom:18}}>{p.title}</div>{p.children}</div></div>;}

/* ═══ APP ═══ */
function App(){
  var _ld=useState(true),loading=_ld[0],setLoading=_ld[1];
  var _tb=useState(0),tab=_tb[0],setTab=_tb[1];
  var _pc=useState([]),pc=_pc[0],setPc=_pc[1];
  var _sp=useState([]),sp=_sp[0],setSp=_sp[1];
  var _st=useState(S_ST),st=_st[0],setSt=_st[1];
  var _su=useState([]),sub=_su[0],setSub=_su[1];
  var _nw=useState(S_NW),nw=_nw[0],setNw=_nw[1];
  var _nh=useState([]),nwh=_nh[0],setNwh=_nh[1];
  var _mo=useState(null),modal=_mo[0],setModal=_mo[1];
  useEffect(function(){var d=loadAll();setPc(d.pc);setSp(d.sp);setSt(d.st);setSub(d.sub);setNw(d.nw);setNwh(d.nwh);setLoading(false);},[]);
  var sPC=useCallback(function(d){setPc(d);sv(KY.pc,d);},[]);
  var sSP=useCallback(function(d){setSp(d);sv(KY.sp,d);},[]);
  var sST=useCallback(function(d){setSt(d);sv(KY.st,d);},[]);
  var sSUB=useCallback(function(d){setSub(d);sv(KY.sub,d);},[]);
  var sNW=useCallback(function(d){setNw(d);sv(KY.nw,d);},[]);
  var sNWH=useCallback(function(d){setNwh(d);sv(KY.nwh,d);},[]);

  var ppData=useMemo(function(){var sorted=pc.slice().sort(function(a,b){return a.date.localeCompare(b.date);});var noWL=sp.filter(function(s){return s.cat!=="Wins/Losses";});var allP=sorted.map(function(p){return p.period;});var running=0;return sorted.map(function(p,i){var pSpend=noWL.filter(function(s){if(s.pid>0){if(allP.indexOf(s.pid)>=0)return s.pid===p.period;return i===sorted.length-1;}var start=i===0?"2000-01-01":p.date;var end=i<sorted.length-1?sorted[i+1].date:"2099-12-31";return s.date>=start&&s.date<end;});var fixS=pSpend.filter(function(e){return FIX.indexOf(e.cat)>=0;}).reduce(function(a,e){return a+e.amt;},0);var discS=pSpend.filter(function(e){return DSC.indexOf(e.cat)>=0;}).reduce(function(a,e){return a+e.amt;},0);var totInv=IK.reduce(function(a,k){return a+(p.inv[k]||0);},0);var discBudget=p.gross-totInv-fixS;if(i>0)running=running+discBudget-discS;return Object.assign({},p,{fixS:fixS,discS:discS,totalSpend:fixS+discS,totInv:totInv,discBudget:discBudget,discRemaining:running,periodSpend:pSpend});});},[pc,sp]);

  var D=useMemo(function(){var aPC=pc.filter(function(p){return p.gross>0;});var gYTD=aPC.reduce(function(s,p){return s+p.gross;},0);var inv={k:0,h:0,r:0,b:0,y:0};aPC.forEach(function(p){IK.forEach(function(k){inv[k]+=(p.inv[k]||0);});});var tInv=Object.values(inv).reduce(function(a,b){return a+b;},0);var noWL=sp.filter(function(s){return s.cat!=="Wins/Losses";});var tSp=noWL.reduce(function(s,e){return s+e.amt;},0);var byCat={};noWL.forEach(function(e){byCat[e.cat]=(byCat[e.cat]||0)+e.amt;});var catArr=Object.entries(byCat).sort(function(a,b){return b[1]-a[1];}).map(function(e){return{cat:e[0],total:e[1],pct:tSp>0?e[1]/tSp:0};});var monthly=MN.map(function(m,mi){var mS=noWL.filter(function(e){return mIdx(e.date)===mi;});var mP=aPC.filter(function(p){return mIdx(p.date)===mi;});var inc=mP.reduce(function(s,p){return s+p.gross;},0);var invested=mP.reduce(function(s,p){return s+IK.reduce(function(a,k){return a+(p.inv[k]||0);},0);},0);var fix=mS.filter(function(e){return FIX.indexOf(e.cat)>=0;}).reduce(function(s,e){return s+e.amt;},0);var disc=mS.filter(function(e){return DSC.indexOf(e.cat)>=0;}).reduce(function(s,e){return s+e.amt;},0);return{month:m,income:inc,invested:invested,fixed:fix,disc:disc,total:fix+disc,cf:inc-invested-fix-disc,pp:mP.length};});var wl=sp.filter(function(s){return s.cat==="Wins/Losses";}).reduce(function(s,e){return s+e.amt;},0);var tA=nw.assets.reduce(function(s,a){return s+a.bal;},0);var tL=nw.liabilities.reduce(function(s,l){return s+l.bal;},0);var dR=ppData.length>0?ppData[ppData.length-1].discRemaining:0;return{gYTD:gYTD,inv:inv,tInv:tInv,tSp:tSp,sRate:gYTD>0?tInv/gYTD:0,catArr:catArr,monthly:monthly,wl:wl,tA:tA,tL:tL,netW:tA-tL,dR:dR,nCF:gYTD-tInv-tSp};},[pc,sp,nw,ppData]);

  function addPC(d){sPC(pc.concat([Object.assign({},d,{id:uid()})]).sort(function(a,b){return a.date.localeCompare(b.date);}));}
  function editPC(id,u){sPC(pc.map(function(p){return p.id===id?Object.assign({},p,u):p;}));}
  function delPC(id){sPC(pc.filter(function(p){return p.id!==id;}));}
  function addSP(d){sSP(sp.concat([Object.assign({},d,{id:uid()})]));}
  function editSP(id,u){sSP(sp.map(function(e){return e.id===id?Object.assign({},e,u):e;}));}
  function delSP(id){sSP(sp.filter(function(e){return e.id!==id;}));}
  function expJSON(){var b=new Blob([JSON.stringify({paychecks:pc,spending:sp,settings:st,subscriptions:sub,netWorth:nw,netWorthHistory:nwh},null,2)],{type:"application/json"});var u=URL.createObjectURL(b);var a=document.createElement("a");a.href=u;a.download="budget-"+td()+".json";a.click();URL.revokeObjectURL(u);}
  function expCSV(){var rows=[["Date","Category","Amount","Note"]].concat(sp.filter(function(s){return s.cat!=="Wins/Losses";}).sort(function(a,b){return a.date.localeCompare(b.date);}).map(function(e){return[e.date,e.cat,e.amt,e.note||""];}));var csv=rows.map(function(r){return r.map(function(c){return typeof c==="string"&&c.indexOf(",")>=0?'"'+c+'"':c;}).join(",");}).join("\n");var b=new Blob([csv],{type:"text/csv"});var u=URL.createObjectURL(b);var a=document.createElement("a");a.href=u;a.download="spending-"+td()+".csv";a.click();URL.revokeObjectURL(u);}
  function saveNWH(updated){sNW(updated);var tA=updated.assets.reduce(function(s,a){return s+a.bal;},0);var tL=updated.liabilities.reduce(function(s,l){return s+l.bal;},0);sNWH(nwh.filter(function(x){return x.date!==td();}).concat([{date:td(),assets:tA,liabilities:tL,net:tA-tL}]).sort(function(a,b){return a.date.localeCompare(b.date);}));}

  var tabs=["Overview","Monthly","Pay Periods","Spending","Goals","Bills","Net Worth","Settings"];
  if(loading)return <div style={{minHeight:"100vh",background:T.bg,display:"flex",alignItems:"center",justifyContent:"center"}}><div style={{color:T.w3,fontSize:14}}>Loading...</div></div>;

  return <div style={{minHeight:"100vh",background:T.bg,color:T.w,fontFamily:"-apple-system,BlinkMacSystemFont,'SF Pro Text','Segoe UI',system-ui,sans-serif",maxWidth:480,margin:"0 auto",paddingBottom:80}}>
    <div style={{padding:"24px 20px 10px",position:"sticky",top:0,background:T.bg,zIndex:100}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"baseline"}}><div><div style={{fontSize:20,fontWeight:700}}>Budget</div><div style={{fontSize:12,color:T.w4,marginTop:2}}>2026</div></div><div style={{display:"flex",gap:8}}><button style={Object.assign({},bS(T.green,false,true),{padding:"10px 16px"})} onClick={function(){setModal("addPC");}}>+ Pay</button><button style={Object.assign({},bS(T.s3,false,true),{padding:"10px 16px",color:T.w2})} onClick={function(){setModal("addSP");}}>+ Spend</button></div></div></div>
    <div style={{display:"flex",gap:6,padding:"8px 20px 6px",overflowX:"auto",scrollbarWidth:"none",WebkitOverflowScrolling:"touch"}}>{tabs.map(function(t,i){return <button key={i} onClick={function(){setTab(i);}} style={{padding:"10px 14px",borderRadius:8,border:"none",fontSize:12,fontWeight:600,cursor:"pointer",flexShrink:0,background:tab===i?T.w:"transparent",color:tab===i?T.bg:T.w4,fontFamily:"inherit",minHeight:44}}>{t}</button>;})}</div>
    <div style={{padding:"12px 20px 20px"}}>
      {tab===0&&<OvTab D={D} st={st}/>}{tab===1&&<MoTab D={D} pc={pc} sm={setModal}/>}{tab===2&&<PPTab pp={ppData} sm={setModal}/>}{tab===3&&<SpTab D={D} sp={sp} sm={setModal}/>}{tab===4&&<GoTab D={D} st={st}/>}{tab===5&&<BiTab sub={sub} sm={setModal}/>}{tab===6&&<NWTab nw={nw} D={D} nwh={nwh} sm={setModal}/>}{tab===7&&<SeTab st={st} sST={sST} ej={expJSON} ec={expCSV}/>}
    </div>
    <APCM open={modal==="addPC"} onClose={function(){setModal(null);}} onSave={function(d){addPC(d);setModal(null);}} st={st} nextP={pc.length>0?Math.max.apply(null,pc.map(function(p){return p.period;}))+1:1}/>
    <EPCM open={modal&&modal.t==="ePC"} data={modal&&modal.t==="ePC"?modal.d:null} onClose={function(){setModal(null);}} onSave={function(id,u){editPC(id,u);setModal(null);}} onDel={function(id){delPC(id);setModal(null);}}/>
    <ASPM open={modal==="addSP"} onClose={function(){setModal(null);}} onSave={function(d){addSP(d);setModal(null);}} pc={pc}/>
    <ESPM open={modal&&modal.t==="eSP"} data={modal&&modal.t==="eSP"?modal.d:null} onClose={function(){setModal(null);}} onSave={function(id,u){editSP(id,u);setModal(null);}} onDel={function(id){delSP(id);setModal(null);}} pc={pc}/>
    <ASuM open={modal==="addSub"} onClose={function(){setModal(null);}} onSave={function(d){sSUB(sub.concat([Object.assign({},d,{id:uid()})]));setModal(null);}}/>
    <ESuM open={modal&&modal.t==="eSub"} data={modal&&modal.t==="eSub"?modal.d:null} onClose={function(){setModal(null);}} onSave={function(id,u){sSUB(sub.map(function(s){return s.id===id?Object.assign({},s,u):s;}));setModal(null);}} onDel={function(id){sSUB(sub.filter(function(s){return s.id!==id;}));setModal(null);}}/>
    <ENWM open={modal&&modal.t==="eNW"} items={modal&&modal.t==="eNW"?modal.items:null} kind={modal&&modal.t==="eNW"?modal.kind:null} onClose={function(){setModal(null);}} onSave={function(u){saveNWH(u);setModal(null);}} nw={nw}/>
  </div>;
}

/* Modals */
function APCM(p){var _d=useState(td()),date=_d[0],setDate=_d[1];var _g=useState(""),gross=_g[0],setGross=_g[1];var _a=useState(true),auto=_a[0],setAuto=_a[1];var _i=useState({k:"",h:"",r:"",b:"",y:""}),inv=_i[0],setInv=_i[1];useEffect(function(){if(p.open){setDate(td());setGross("");setAuto(true);setInv({k:"",h:"",r:"",b:"",y:""});}},[p.open]);var g=parseFloat(gross)||0;var fI={};IK.forEach(function(k){fI[k]=auto?+(g*(p.st.investPcts[k]||0)).toFixed(2):(parseFloat(inv[k])||0);});var tI=Object.values(fI).reduce(function(a,b){return a+b;},0);return <Modal open={p.open} onClose={p.onClose} title="Add Paycheck"><Inp label="Date" value={date} onChange={setDate} type="date"/><Inp label="Gross Pay" value={gross} onChange={setGross} type="number" ph="0.00"/><div style={{display:"flex",alignItems:"center",gap:8,marginBottom:14}}><input type="checkbox" checked={auto} onChange={function(){setAuto(!auto);}} style={{accentColor:T.blue}}/><span style={{fontSize:13,color:T.w3}}>Auto-calculate from %</span></div>{!auto&&<div style={{background:T.bg,borderRadius:12,padding:14,marginBottom:14}}>{IK.map(function(k){return <Inp key={k} label={IL[k]} value={inv[k]} onChange={function(v){var n=Object.assign({},inv);n[k]=v;setInv(n);}} type="number" ph="0.00"/>;})}</div>}{g>0&&<Cd sx={{marginBottom:16,background:T.bg}}>{IK.map(function(k){return <div key={k} style={{display:"flex",justifyContent:"space-between",padding:"4px 0",fontSize:13,color:T.w3}}><span>{IL[k]}</span><span style={{color:T.green,fontWeight:600}}>{fmt(fI[k])}</span></div>;})}<div style={{borderTop:"1px solid "+T.b,marginTop:8,paddingTop:8,display:"flex",justifyContent:"space-between",fontSize:13,fontWeight:700}}><span>Invested</span><span style={{color:T.green}}>{fmt(tI)}</span></div><div style={{display:"flex",justifyContent:"space-between",fontSize:13,color:T.amber,marginTop:4}}><span>Remaining</span><span>{fmt(g-tI)}</span></div></Cd>}<button style={bS(T.green,false,false,true,!date||g<0)} onClick={function(){if(date&&g>=0)p.onSave({date:date,period:p.nextP,gross:g,inv:fI});}}>Save Paycheck</button></Modal>;}

function EPCM(p){var _d=useState(""),date=_d[0],setDate=_d[1];var _g=useState(""),gross=_g[0],setGross=_g[1];var _i=useState({k:"",h:"",r:"",b:"",y:""}),inv=_i[0],setInv=_i[1];useEffect(function(){if(p.data){setDate(p.data.date);setGross(String(p.data.gross));var i={};IK.forEach(function(k){i[k]=String(p.data.inv[k]||0);});setInv(i);}},[p.data]);if(!p.data)return null;return <Modal open={p.open} onClose={p.onClose} title="Edit Paycheck"><Inp label="Date" value={date} onChange={setDate} type="date"/><Inp label="Gross Pay" value={gross} onChange={setGross} type="number"/><div style={{background:T.bg,borderRadius:12,padding:14,marginBottom:14}}>{IK.map(function(k){return <Inp key={k} label={IL[k]} value={inv[k]} onChange={function(v){var n=Object.assign({},inv);n[k]=v;setInv(n);}} type="number"/>;})}</div><div style={{display:"flex",gap:10}}><button style={bS(T.red,true,false,true)} onClick={function(){p.onDel(p.data.id);}}>Delete</button><button style={bS(T.green,false,false,true)} onClick={function(){var fi={};IK.forEach(function(k){fi[k]=parseFloat(inv[k])||0;});p.onSave(p.data.id,{date:date,gross:parseFloat(gross)||0,inv:fi});}}>Save</button></div></Modal>;}

function ASPM(p){var _d=useState(td()),date=_d[0],setDate=_d[1];var _c=useState("Food"),cat=_c[0],setCat=_c[1];var _a=useState(""),amt=_a[0],setAmt=_a[1];var _n=useState(""),note=_n[0],setNote=_n[1];var _p=useState(0),pid=_p[0],setPid=_p[1];useEffect(function(){if(p.open){setDate(td());setCat("Food");setAmt("");setNote("");setPid(p.pc.length>0?Math.max.apply(null,p.pc.map(function(x){return x.period;})):0);}},[p.open,p.pc]);var periods=p.pc.map(function(x){return x.period;}).sort(function(a,b){return b-a;});return <Modal open={p.open} onClose={p.onClose} title="Add Spending"><Inp label="Date" value={date} onChange={setDate} type="date"/><Sel label="Category" value={cat} onChange={setCat} opts={CATS}/><Inp label="Amount" value={amt} onChange={setAmt} type="number" ph="0.00"/>{periods.length>0&&<Sel label="Pay Period" value={pid} onChange={function(v){setPid(parseInt(v));}} opts={periods.map(String)}/>}<Inp label="Note (optional)" value={note} onChange={setNote} ph="What was this for?"/><button style={bS(T.green,false,false,true,!parseFloat(amt))} onClick={function(){if(parseFloat(amt)&&date)p.onSave({date:date,cat:cat,amt:parseFloat(amt),note:note,pid:pid});}}>Add Entry</button></Modal>;}

function ESPM(p){var _d=useState(""),date=_d[0],setDate=_d[1];var _c=useState("Food"),cat=_c[0],setCat=_c[1];var _a=useState(""),amt=_a[0],setAmt=_a[1];var _n=useState(""),note=_n[0],setNote=_n[1];var _p2=useState(0),pid=_p2[0],setPid=_p2[1];useEffect(function(){if(p.data){setDate(p.data.date);setCat(p.data.cat);setAmt(String(p.data.amt));setNote(p.data.note||"");setPid(p.data.pid||0);}},[p.data]);if(!p.data)return null;var periods=p.pc.map(function(x){return x.period;}).sort(function(a,b){return b-a;});return <Modal open={p.open} onClose={p.onClose} title="Edit Entry"><Inp label="Date" value={date} onChange={setDate} type="date"/><Sel label="Category" value={cat} onChange={setCat} opts={CATS}/><Inp label="Amount" value={amt} onChange={setAmt} type="number"/>{periods.length>0&&<Sel label="Pay Period" value={pid} onChange={function(v){setPid(parseInt(v));}} opts={periods.map(String).concat(["0"])}/>}<Inp label="Note" value={note} onChange={setNote}/><div style={{display:"flex",gap:10}}><button style={bS(T.red,true,false,true)} onClick={function(){p.onDel(p.data.id);}}>Delete</button><button style={bS(T.green,false,false,true)} onClick={function(){p.onSave(p.data.id,{date:date,cat:cat,amt:parseFloat(amt)||0,note:note,pid:pid});}}>Save</button></div></Modal>;}

function ASuM(p){var _n=useState(""),name=_n[0],setName=_n[1];var _c=useState(""),cost=_c[0],setCost=_c[1];var _ct=useState("Subscriptions"),cat=_ct[0],setCat=_ct[1];useEffect(function(){if(p.open){setName("");setCost("");setCat("Subscriptions");}},[p.open]);return <Modal open={p.open} onClose={p.onClose} title="Add Subscription"><Inp label="Name" value={name} onChange={setName} ph="e.g. Netflix"/><Inp label="Monthly Cost" value={cost} onChange={setCost} type="number" ph="0.00"/><Sel label="Category" value={cat} onChange={setCat} opts={SC}/><button style={bS(T.green,false,false,true,!name||!parseFloat(cost))} onClick={function(){if(name&&parseFloat(cost))p.onSave({name:name,cost:parseFloat(cost),cat:cat});}}>Add</button></Modal>;}

function ESuM(p){var _n=useState(""),name=_n[0],setName=_n[1];var _c=useState(""),cost=_c[0],setCost=_c[1];var _ct=useState("Subscriptions"),cat=_ct[0],setCat=_ct[1];useEffect(function(){if(p.data){setName(p.data.name);setCost(String(p.data.cost));setCat(p.data.cat);}},[p.data]);if(!p.data)return null;return <Modal open={p.open} onClose={p.onClose} title="Edit Subscription"><Inp label="Name" value={name} onChange={setName}/><Inp label="Monthly Cost" value={cost} onChange={setCost} type="number"/><Sel label="Category" value={cat} onChange={setCat} opts={SC}/><div style={{display:"flex",gap:10}}><button style={bS(T.red,true,false,true)} onClick={function(){p.onDel(p.data.id);}}>Delete</button><button style={bS(T.green,false,false,true)} onClick={function(){p.onSave(p.data.id,{name:name,cost:parseFloat(cost)||0,cat:cat});}}>Save</button></div></Modal>;}

function ENWM(p){var _r=useState([]),rows=_r[0],setRows=_r[1];useEffect(function(){if(p.items)setRows(p.items.map(function(d){return Object.assign({},d,{bal:String(d.bal)});}));},[p.items]);if(!p.items)return null;return <Modal open={p.open} onClose={p.onClose} title={"Edit "+(p.kind==="assets"?"Assets":"Liabilities")}>{rows.map(function(r,i){return <div key={r.id||i} style={{display:"flex",gap:8,marginBottom:10,alignItems:"flex-end"}}><Inp label={i===0?"Name":undefined} value={r.name} onChange={function(v){var n=rows.slice();n[i]=Object.assign({},n[i],{name:v});setRows(n);}} sx={{flex:1,marginBottom:0}}/><Inp label={i===0?"Balance":undefined} value={r.bal} onChange={function(v){var n=rows.slice();n[i]=Object.assign({},n[i],{bal:v});setRows(n);}} type="number" sx={{flex:1,marginBottom:0}}/><button style={Object.assign({},bS(T.red,true,true),{flexShrink:0,height:40})} onClick={function(){setRows(rows.filter(function(_,j){return j!==i;}));}}>✕</button></div>;})}<button style={Object.assign({},bS(T.blue,true,true),{marginBottom:16})} onClick={function(){setRows(rows.concat([{id:uid(),name:"",bal:"0"}]));}}>+ Add</button><button style={bS(T.green,false,false,true)} onClick={function(){var pr=rows.filter(function(r){return r.name;}).map(function(r){return Object.assign({},r,{bal:parseFloat(r.bal)||0});});p.onSave(p.kind==="assets"?Object.assign({},p.nw,{assets:pr}):Object.assign({},p.nw,{liabilities:pr}));}}>Save</button></Modal>;}

/* Tabs */
function OvTab(p){var D=p.D,st=p.st;var invArr=IK.map(function(k){return{name:IL[k],ytd:D.inv[k],pctT:st.investPcts[k]||0};});var invPie=invArr.filter(function(i){return i.ytd>0;}).map(function(i){return{name:i.name,value:i.ytd};});var remC=D.dR>=0?T.green:T.red;return <div style={{display:"flex",flexDirection:"column",gap:14}}><Cd sx={{borderColor:D.dR>=0?T.green+"30":T.red+"30"}}><div style={{fontSize:11,color:T.w4,fontWeight:600,letterSpacing:1,textTransform:"uppercase"}}>Discretionary Remaining</div><div style={{fontSize:32,fontWeight:800,color:remC,letterSpacing:-1,marginTop:4}}>{fmt(D.dR)}</div><div style={{fontSize:12,color:T.w4,marginTop:4}}>Rolling balance across pay periods</div></Cd><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}>{[["Income",D.gYTD,T.w],["Invested",D.tInv,T.green],["Spent",D.tSp,T.red],["Cash Flow",D.nCF,D.nCF>=0?T.green:T.red]].map(function(x,i){return <Cd key={i} sx={{padding:14}}><div style={{fontSize:11,color:T.w4}}>{x[0]}</div><div style={{fontSize:18,fontWeight:700,color:x[2],marginTop:4}}>{fmt(x[1])}</div></Cd>;})}</div><Cd><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}}><span style={{fontSize:12,color:T.w3}}>Savings Rate</span><span style={{fontSize:22,fontWeight:800,color:T.green}}>{pct(D.sRate)}</span></div><PB p={D.sRate} color={T.green}/></Cd><SH>Investments</SH><Cd><DonutChart data={invPie}/>{invArr.map(function(inv,i){var a=D.gYTD>0?inv.ytd/D.gYTD:0;return <div key={i} style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 0",borderTop:i>0?"1px solid "+T.bSub:"none"}}><div style={{display:"flex",alignItems:"center",gap:8}}><div style={{width:8,height:8,borderRadius:"50%",background:PC[i]}}/><span style={{fontSize:13}}>{inv.name}</span></div><div style={{textAlign:"right"}}><div style={{fontSize:14,fontWeight:600}}>{fmt(inv.ytd)}</div><div style={{fontSize:11,color:a>=inv.pctT?T.green:T.amber}}>{pct(a)} / {pct(inv.pctT)}</div></div></div>;})}</Cd><SH>Top Spending</SH><Cd>{D.catArr.slice(0,6).map(function(s,i){return <div key={i} style={{marginBottom:i<5?12:0}}><div style={{display:"flex",justifyContent:"space-between",marginBottom:4}}><span style={{fontSize:13}}>{s.cat}</span><span style={{fontSize:13,color:T.w3,fontWeight:600}}>{fmt(s.total)}</span></div><PB p={s.pct} color={PC[i]}/></div>;})}</Cd></div>;}

function MoTab(p){var D=p.D,pc=p.pc,sm=p.sm;var active=D.monthly.filter(function(m){return m.income>0||m.total>0;});var cd=active.map(function(m){return{name:m.month,Invested:m.invested,Fixed:m.fixed,Disc:m.disc};});var trend=D.monthly.filter(function(m){return m.income>0;}).map(function(m){return{name:m.month,Income:+m.income.toFixed(2),Spent:+m.total.toFixed(2),Invested:+m.invested.toFixed(2)};});return <div style={{display:"flex",flexDirection:"column",gap:14}}>{trend.length>1&&<><SH>Trend</SH><Cd><LineC data={trend} keys={["Income","Spent","Invested"]} colors={[T.w,T.red,T.green]} legend={true}/></Cd></>}<SH>Breakdown</SH>{cd.length>0&&<Cd><BarC data={cd} keys={["Invested","Fixed","Disc"]} colors={[T.green,T.blue,T.orange]} legend={true}/></Cd>}{D.monthly.map(function(m,mi){if(m.income===0&&m.total===0)return null;var mPC=pc.filter(function(x){return mIdx(x.date)===mi&&x.gross>0;});return <Cd key={mi}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}><span style={{fontSize:16,fontWeight:700}}>{m.month}</span><span style={{fontSize:11,padding:"3px 10px",borderRadius:20,background:m.total>m.income?T.redDim:T.greenDim,color:m.total>m.income?T.red:T.green,fontWeight:600}}>{m.total>m.income?"Over":"Under"}</span></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>{[["Income",m.income,T.w],["Invested",m.invested,T.green],["Fixed",m.fixed,T.blue],["Disc.",m.disc,T.orange],["Total Spent",m.total,T.red],["Cash Flow",m.cf,m.cf>=0?T.green:T.red]].map(function(x,j){return <div key={j} style={{padding:"8px 10px",background:T.bg,borderRadius:10}}><div style={{fontSize:10,color:T.w4}}>{x[0]}</div><div style={{fontSize:14,fontWeight:700,color:x[2],marginTop:2}}>{fmt(x[1])}</div></div>;})}</div>{mPC.length>0&&<div style={{marginTop:10}}>{mPC.map(function(x){return <div key={x.id} onClick={function(){sm({t:"ePC",d:x});}} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 12px",background:T.bg,borderRadius:10,marginBottom:4,cursor:"pointer",minHeight:48}}><span style={{fontSize:12,color:T.w3}}>{dFmt(x.date)} · PP{x.period}</span><span style={{fontSize:13,fontWeight:600,color:T.green}}>{fmt(x.gross)}</span></div>;})}</div>}</Cd>;})}</div>;}

function PPTab(p){var ppD=p.pp,sm=p.sm;var active=ppD.filter(function(x){return x.gross>0;});var cd=active.map(function(x){return{name:"PP"+x.period,Budget:+x.discBudget.toFixed(2),Spent:+x.discS.toFixed(2)};});var cd2=active.map(function(x){return{name:"PP"+x.period,Remaining:+x.discRemaining.toFixed(2)};});return <div style={{display:"flex",flexDirection:"column",gap:14}}><SH>Pay Period Overview</SH>{cd.length>0&&<Cd><BarC data={cd} keys={["Budget","Spent"]} colors={[T.blue,T.orange]} legend={true}/><LineC data={cd2} keys={["Remaining"]} colors={[T.green]} filled={true} height={100}/></Cd>}{active.map(function(pp){var over=pp.discS>pp.discBudget;return <Cd key={pp.id}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}><div style={{display:"flex",alignItems:"center",gap:8}}><span style={{fontSize:16,fontWeight:700}}>PP{pp.period}</span><span style={{fontSize:11,padding:"3px 10px",borderRadius:20,background:over?T.redDim:T.greenDim,color:over?T.red:T.green,fontWeight:600}}>{over?"Over":"Under"}</span></div><span style={{fontSize:12,color:T.w4}}>{dFmt(pp.date)}</span></div><div onClick={function(){sm({t:"ePC",d:pp});}} style={{cursor:"pointer",padding:"12px 14px",background:T.bg,borderRadius:10,marginBottom:10,display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:48}}><span style={{fontSize:12,color:T.w3}}>Gross Pay</span><span style={{fontSize:14,fontWeight:700}}>{fmt(pp.gross)}</span></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginBottom:10}}>{[["Invested",pp.totInv,T.green],["Fixed",pp.fixS,T.blue],["Disc Budget",pp.discBudget,T.w],["Disc Spent",pp.discS,T.orange]].map(function(x,j){return <div key={j} style={{padding:"8px 10px",background:T.bg,borderRadius:10}}><div style={{fontSize:10,color:T.w4}}>{x[0]}</div><div style={{fontSize:14,fontWeight:700,color:x[2],marginTop:2}}>{fmt(x[1])}</div></div>;})}</div><div style={{padding:"10px 14px",background:T.bg,borderRadius:10,display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid "+(pp.discRemaining>=0?T.green:T.red)+"20"}}><span style={{fontSize:12,color:T.w3}}>Running Remaining</span><span style={{fontSize:18,fontWeight:800,color:pp.discRemaining>=0?T.green:T.red}}>{fmt(pp.discRemaining)}</span></div>{pp.periodSpend.length>0&&<details style={{marginTop:10}}><summary style={{fontSize:12,color:T.blue,cursor:"pointer",fontWeight:600}}>{pp.periodSpend.length} transactions</summary><div style={{marginTop:6}}>{pp.periodSpend.sort(function(a,b){return a.date.localeCompare(b.date);}).map(function(e,j){return <div key={e.id} onClick={function(){sm({t:"eSP",d:e});}} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 8px",borderTop:j>0?"1px solid "+T.bSub:"none",cursor:"pointer",fontSize:12,minHeight:44}}><div><span style={{fontWeight:500}}>{e.cat}</span><span style={{color:T.w4,marginLeft:6}}>{dFmt(e.date)}</span></div><span style={{fontWeight:600,color:e.amt<0?T.green:T.w}}>{fmt(e.amt)}</span></div>;})}</div></details>}</Cd>;})}</div>;}

function SpTab(p){var D=p.D,sp=p.sp,sm=p.sm;var _f=useState("All"),filter=_f[0],setFilter=_f[1];var _s=useState(""),search=_s[0],setSearch=_s[1];var noWL=sp.filter(function(s){return s.cat!=="Wins/Losses";});var searched=search?noWL.filter(function(e){return(e.cat+" "+(e.note||"")+" "+e.date).toLowerCase().indexOf(search.toLowerCase())>=0;}):noWL;var filtered=filter==="All"?searched:searched.filter(function(s){return s.cat===filter;});var sorted=filtered.slice().sort(function(a,b){return b.date.localeCompare(a.date);});var pieData=D.catArr.filter(function(s){return s.total>0;}).map(function(s){return{name:s.cat,value:s.total};});return <div style={{display:"flex",flexDirection:"column",gap:14}}><div style={{display:"flex",gap:8}}><Cd sx={{flex:1,textAlign:"center",padding:14}}><div style={{fontSize:10,color:T.w4}}>Total Spent</div><div style={{fontSize:18,fontWeight:700,color:T.red,marginTop:2}}>{fmt(D.tSp)}</div></Cd><Cd sx={{flex:1,textAlign:"center",padding:14}}><div style={{fontSize:10,color:T.w4}}>Wins/Losses</div><div style={{fontSize:18,fontWeight:700,color:D.wl>=0?T.green:T.red,marginTop:2}}>{fmt(D.wl)}</div></Cd></div>{pieData.length>0&&<Cd><DonutChart data={pieData}/>{D.catArr.filter(function(s){return s.total>0;}).map(function(s,i){return <div key={i} style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"7px 0",borderTop:i>0?"1px solid "+T.bSub:"none"}}><div style={{display:"flex",alignItems:"center",gap:8}}><div style={{width:8,height:8,borderRadius:2,background:PC[i]}}/><span style={{fontSize:12}}>{s.cat}</span></div><div><span style={{fontSize:13,fontWeight:600}}>{fmt(s.total)}</span><span style={{fontSize:11,color:T.w4,marginLeft:6}}>{pct(s.pct)}</span></div></div>;})}</Cd>}<SH>Log</SH><div style={{position:"relative"}}><input value={search} onChange={function(e){setSearch(e.target.value);}} placeholder="Search..." style={Object.assign({},iS,{paddingLeft:36})}/><span style={{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",fontSize:14,color:T.w4}}>⌕</span></div><div style={{display:"flex",gap:6,overflowX:"auto",scrollbarWidth:"none",paddingBottom:4}}>{["All"].concat(CATS.filter(function(c){return c!=="Wins/Losses";})).map(function(c){return <button key={c} onClick={function(){setFilter(c);}} style={{padding:"8px 14px",borderRadius:8,border:"none",fontSize:12,fontWeight:600,cursor:"pointer",flexShrink:0,background:filter===c?T.w:"transparent",color:filter===c?T.bg:T.w4,fontFamily:"inherit",minHeight:40}}>{c}</button>;})}</div><Cd sx={{padding:10}}>{sorted.length===0&&<div style={{padding:20,textAlign:"center",color:T.w4,fontSize:13}}>No entries{search?" matching search":""}</div>}{sorted.slice(0,80).map(function(e,i){return <div key={e.id} onClick={function(){sm({t:"eSP",d:e});}} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 10px",borderTop:i>0?"1px solid "+T.bSub:"none",cursor:"pointer",minHeight:52}}><div><div style={{fontSize:13,fontWeight:500}}>{e.cat}</div><div style={{fontSize:11,color:T.w4}}>{dFmt(e.date)}{e.note?" · "+e.note:""}</div></div><span style={{fontSize:14,fontWeight:600,color:e.amt<0?T.green:T.w,flexShrink:0,marginLeft:8}}>{fmt(e.amt)}</span></div>;})}</Cd></div>;}

function GoTab(p){var D=p.D,st=p.st;return <div style={{display:"flex",flexDirection:"column",gap:14}}><SH>Savings Goals</SH>{Object.entries(GL).map(function(entry,i){var k=entry[0],name=entry[1];var target=st.goalTargets[k]||0,current=D.inv[GIM[k]]||0;var pr=target>0?current/target:0;var color=pr>=1?T.green:pr>=0.25?T.blue:T.red;return <Cd key={i}><div style={{display:"flex",justifyContent:"space-between",marginBottom:10}}><div style={{fontSize:15,fontWeight:700}}>{name}</div><span style={{fontSize:11,color:T.w4,background:T.bg,padding:"3px 10px",borderRadius:8}}>{pr>=1?"✓ Done":"In Progress"}</span></div><PB p={pr} color={color} h={8}/><div style={{display:"flex",justifyContent:"space-between",marginTop:10}}><div><div style={{fontSize:10,color:T.w4}}>Current</div><div style={{fontSize:15,fontWeight:700,color:color}}>{fmt(current)}</div></div><div style={{textAlign:"center"}}><div style={{fontSize:10,color:T.w4}}>Progress</div><div style={{fontSize:15,fontWeight:700,color:color}}>{pct(pr)}</div></div><div style={{textAlign:"right"}}><div style={{fontSize:10,color:T.w4}}>Remaining</div><div style={{fontSize:15,fontWeight:700,color:T.w3}}>{fmt(Math.max(0,target-current))}</div></div></div><div style={{fontSize:11,color:T.w4,marginTop:8,textAlign:"center"}}>Target: {fmt(target)}</div></Cd>;})}</div>;}

function BiTab(p){var sub=p.sub,sm=p.sm;var total=sub.reduce(function(s,x){return s+x.cost;},0);var grouped={};sub.forEach(function(s){if(!grouped[s.cat])grouped[s.cat]=[];grouped[s.cat].push(s);});return <div style={{display:"flex",flexDirection:"column",gap:14}}><button style={bS(T.s3,false,false,true)} onClick={function(){sm("addSub");}}><span style={{color:T.w2}}>+ Add Subscription</span></button><div style={{display:"flex",gap:8}}><Cd sx={{flex:1,textAlign:"center",padding:14}}><div style={{fontSize:10,color:T.w4}}>Monthly</div><div style={{fontSize:18,fontWeight:700,color:T.blue,marginTop:2}}>{fmt(total)}</div></Cd><Cd sx={{flex:1,textAlign:"center",padding:14}}><div style={{fontSize:10,color:T.w4}}>Annual</div><div style={{fontSize:18,fontWeight:700,color:T.amber,marginTop:2}}>{fmt(total*12)}</div></Cd></div>{Object.entries(grouped).map(function(entry,gi){var cat=entry[0],items=entry[1];return <Cd key={gi}><div style={{fontSize:11,fontWeight:700,color:T.w4,marginBottom:10,letterSpacing:1,textTransform:"uppercase"}}>{cat}</div>{items.map(function(s,i){return <div key={s.id} onClick={function(){sm({t:"eSub",d:s});}} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 4px",borderTop:i>0?"1px solid "+T.bSub:"none",cursor:"pointer",minHeight:48}}><span style={{fontSize:13}}>{s.name}</span><div style={{textAlign:"right"}}><span style={{fontSize:14,fontWeight:600}}>{fmt(s.cost)}</span><span style={{fontSize:10,color:T.w4}}>/mo</span></div></div>;})}</Cd>;})}</div>;}

function NWTab(p){var nw=p.nw,D=p.D,nwh=p.nwh,sm=p.sm;var aD=nw.assets.filter(function(a){return a.bal>0;}).map(function(a){return{name:a.name,value:a.bal};});var lD=nw.liabilities.filter(function(l){return l.bal>0;}).map(function(l){return{name:l.name,value:l.bal};});var hist=nwh.map(function(h){return{name:dFmt(h.date),Assets:h.assets,Liabilities:h.liabilities,Net:h.net};});return <div style={{display:"flex",flexDirection:"column",gap:14}}><Cd sx={{textAlign:"center"}}><div style={{fontSize:11,color:T.w4,fontWeight:600,letterSpacing:1}}>NET WORTH</div><div style={{fontSize:32,fontWeight:800,color:D.netW>=0?T.green:T.red,letterSpacing:-1,marginTop:4}}>{fmt(D.netW)}</div><div style={{display:"flex",justifyContent:"center",gap:28,marginTop:12}}><div><div style={{fontSize:10,color:T.w4}}>Assets</div><div style={{fontSize:16,fontWeight:700,color:T.green}}>{fmt(D.tA)}</div></div><div style={{width:1,background:T.b}}/><div><div style={{fontSize:10,color:T.w4}}>Liabilities</div><div style={{fontSize:16,fontWeight:700,color:T.red}}>{fmt(D.tL)}</div></div></div></Cd>{hist.length>1&&<><SH>History</SH><Cd><LineC data={hist} keys={["Assets","Liabilities","Net"]} colors={[T.green,T.red,T.blue]} legend={true}/></Cd></>}{hist.length<=1&&<Cd sx={{textAlign:"center",padding:20}}><div style={{fontSize:13,color:T.w4}}>History chart appears after your second balance update</div></Cd>}<div style={{display:"flex",gap:8}}>{[[aD,"Assets",T.green,[T.green,T.cyan,T.blue,T.purple,T.amber]],[lD,"Liabilities",T.red,[T.red,T.orange,T.pink]]].map(function(x,idx){return <Cd key={idx} sx={{flex:1,padding:10}}><DonutChart data={x[0]} colors={x[3]} size={110} inner={0.5}/><div style={{textAlign:"center",fontSize:11,color:x[2],fontWeight:600}}>{x[1]}</div></Cd>;})}</div>{[["assets",nw.assets,T.green,"Assets"],["liabilities",nw.liabilities,T.red,"Liabilities"]].map(function(x){return <Cd key={x[0]}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}><span style={{fontSize:12,fontWeight:700,color:x[2],letterSpacing:0.5}}>{x[3]}</span><button style={bS(x[2],true,true)} onClick={function(){sm({t:"eNW",items:x[1],kind:x[0]});}}>Edit</button></div>{x[1].map(function(a,i){return <div key={a.id} style={{display:"flex",justifyContent:"space-between",padding:"8px 0",borderTop:i>0?"1px solid "+T.bSub:"none"}}><span style={{fontSize:13}}>{a.name}</span><span style={{fontSize:14,fontWeight:600,color:a.bal>0?x[2]:T.w4}}>{fmt(a.bal)}</span></div>;})}<div style={{display:"flex",justifyContent:"space-between",paddingTop:8,borderTop:"1px solid "+T.b,marginTop:4}}><span style={{fontWeight:700}}>Total</span><span style={{fontWeight:700,color:x[2]}}>{fmt(x[1].reduce(function(s,a){return s+a.bal;},0))}</span></div></Cd>;})}</div>;}

function SeTab(p){var st=p.st,sST=p.sST;var _p=useState(Object.assign({},st.investPcts)),pcts=_p[0],setPcts=_p[1];var _g=useState(Object.assign({},st.goalTargets)),goals=_g[0],setGoals=_g[1];var _sv=useState(false),saved=_sv[0],setSaved=_sv[1];var _rc=useState(false),resetC=_rc[0],setResetC=_rc[1];function handleSave(){var pr={},g={};Object.entries(pcts).forEach(function(e){pr[e[0]]=parseFloat(e[1])||0;});Object.entries(goals).forEach(function(e){g[e[0]]=parseFloat(e[1])||0;});sST({investPcts:pr,goalTargets:g});setSaved(true);setTimeout(function(){setSaved(false);},2000);}function handleReset(){try{Object.values(KY).forEach(function(k){localStorage.removeItem(k);});}catch(e){}window.location.reload();}var totalPct=Object.values(pcts).reduce(function(s,v){return s+(parseFloat(v)||0);},0);return <div style={{display:"flex",flexDirection:"column",gap:14}}><SH>Investment %</SH><Cd>{IK.map(function(k){return <div key={k} style={{display:"flex",alignItems:"center",gap:10,marginBottom:10}}><span style={{fontSize:13,minWidth:80}}>{IL[k]}</span><input value={pcts[k]} onChange={function(e){var n=Object.assign({},pcts);n[k]=e.target.value;setPcts(n);}} type="number" step="0.01" style={Object.assign({},iS,{flex:1})}/><span style={{fontSize:11,color:T.w4,minWidth:40}}>{pct(parseFloat(pcts[k])||0)}</span></div>;})}<div style={{display:"flex",justifyContent:"space-between",paddingTop:8,borderTop:"1px solid "+T.b}}><span style={{fontSize:13,fontWeight:600}}>Total</span><span style={{fontSize:14,fontWeight:700,color:totalPct<=1?T.green:T.red}}>{pct(totalPct)}</span></div></Cd><SH>Goal Targets</SH><Cd>{Object.entries(GL).map(function(entry){var k=entry[0],label=entry[1];return <div key={k} style={{display:"flex",alignItems:"center",gap:10,marginBottom:10}}><span style={{fontSize:12,minWidth:110}}>{label}</span><input value={goals[k]} onChange={function(e){var n=Object.assign({},goals);n[k]=e.target.value;setGoals(n);}} type="number" style={Object.assign({},iS,{flex:1})}/></div>;})}</Cd><button style={bS(T.green,false,false,true)} onClick={handleSave}>{saved?"✓ Saved":"Save Settings"}</button><SH>Export</SH><Cd><div style={{fontSize:12,color:T.w3,marginBottom:12}}>Download for backup or spreadsheet sync.</div><div style={{display:"flex",gap:10}}><button style={bS(T.blue,true,false,true)} onClick={p.ej}>JSON</button><button style={bS(T.purple,true,false,true)} onClick={p.ec}>CSV</button></div></Cd><SH>Reset</SH><Cd sx={{borderColor:T.red+"20"}}><div style={{fontSize:12,color:T.w3,marginBottom:10}}>Restore to empty. Cannot be undone.</div>{!resetC?<button style={bS(T.red,true,false,true)} onClick={function(){setResetC(true);}}>Reset All Data</button>:<div style={{display:"flex",gap:10}}><button style={bS(T.s3,true,false,true)} onClick={function(){setResetC(false);}}>Cancel</button><button style={bS(T.red,false,false,true)} onClick={handleReset}>Confirm</button></div>}</Cd></div>;}

try{ReactDOM.createRoot(document.getElementById("root")).render(<App/>);}catch(e){document.getElementById("root").innerHTML='<div style="padding:40px;color:#f87171;font-family:system-ui;font-size:14px"><b>Error:</b><br>'+e.message+'</div>';}
</script>
<script>if('serviceWorker' in navigator){navigator.serviceWorker.register('sw.js').catch(function(){});}</script>
</body>
</html>